<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socket Test Coach</title>
  </head>
  <body onbeforeunload="return closeWebSocket()">
    <p id="Message">Connecting to AWS...</p>
    <script>
      debugger;
      const example_socket = new WebSocket(
        "wss://mjim68pp6h.execute-api.us-east-2.amazonaws.com/production/"
      );

      example_socket.onopen = (event) => {
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br />Connected to AWS";
        let set_connection_type_data = {
          action: "setConnectionType",
          type: "coach",
        };
        example_socket.send(JSON.stringify(set_connection_type_data));
        let data = {
          action: "createRoom",
          lane: "test lane",
        };
        example_socket.send(JSON.stringify(data));
        setInterval(() => example_socket.send({ action: "keepAlive" }), 120000);
      };

      example_socket.onerror = (event) => {
        debugger;
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br />There was an error";
        p.innerHTML = p.innerHTML + "<br />Error: " + event.toString();
      };

      example_socket.onmessage = (event) => {
        debugger;
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br >Message Recieved";
        let data = JSON.parse(event.data);
        if (data?.message == "Internal server error")
          p.innerHTML = p.innerHTML += "<br />" + data.message;
        if (data?.type == "RoomCreated") {
          processRoomCreation(data.data);
        } else if (data?.type == "LaneConnect") {
          processLaneConnect(data.laneNumber);
        } else if (data?.type == "LaneDisconnect") {
          processLaneDisconnect(data.laneNumber);
        }
      };

      function processRoomCreation(data) {
        debugger;
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br />Room Created: " + data.room_key;
      }

      function processLaneConnect(lane) {
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br />" + "Lane Connected: " + lane;
      }

      function processLaneDisconnect(lane) {
        let p = document.getElementById("Message");
        p.innerHTML = p.innerHTML + "<br />" + "Lane Disonnected: " + lane;
      }

      function closeWebSocket() {
        debugger;
        example_socket.close();
      }

      let stop = 1;
    </script>
  </body>
</html>
