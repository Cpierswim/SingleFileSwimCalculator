<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Set Maker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      :root {
        --modal-border-radius: 15px;
        --common-radius: 0.375rem;
      }
      input:focus {
        outline: none;
      }
      textarea:focus {
        outline: none;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-size: 2vh;
      }
      #full_screen {
        min-width: 100%;
        width: fit-content;
        height: 100%;
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
      }
      .tab_row {
        display: flex;
        flex-wrap: nowrap;
        justify-content: start;
        align-items: flex-end;
        flex-grow: 0;
        padding-left: max(2vw, 15px);
        padding-right: max(2vw, 15px);
        margin-top: 0.5vh;
      }
      .times_row {
        border-style: solid;
        border-bottom-style: none;
        margin-right: 0.75vw;
        padding-left: 12px;
        padding-right: 10vw;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        margin-top: 3px;
        display: flex;
        flex-wrap: nowrap;
        border-width: 2px;
        padding-top: 4px;
      }
      .set_time {
        background-color: lightblue;
        padding: 3px;
        border-radius: var(--common-radius);
        border-width: 2px;
        border-style: solid;
        padding: 5px;
        margin-left: 3vw;
      }
      .spacer {
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 12px;
      }
      .tab {
        background-color: darkgray;
        border-style: solid;
        border-width: 1px;
        border-color: black;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        border-bottom-width: 0px;
        min-width: 3vw;
        padding: 4px;
        padding-left: 12px;
        padding-right: 12px;
        cursor: pointer;
        flex-grow: 0;
        flex-shrink: 1;
        flex-basis: auto;
        align-self: stretch;
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
        transition: background-color 0.2s;
        width: fit-content;
      }
      .tab:hover {
        background-color: rgb(232, 232, 232);
      }
      .tab:active:hover {
        background-color: gray;
        transition: none;
      }
      .display {
        border-width: 3px;
        background-color: rgb(232, 232, 232);
        flex: 1 1 auto;
        border-top-style: solid;
        border-top-width: 2px;
        border-top-color: black;
        border-left-style: solid;
        border-left-width: 2px;
        border-left-color: black;
        border-right-style: solid;
        border-right-width: 2px;
        border-right-color: black;
      }
      .active_tab {
        background-color: rgb(232, 232, 232) !important;
        cursor: default !important;
      }
      .hide {
        display: none !important;
      }
      .sub_display {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        margin-right: 0.75vw;
        margin-bottom: 1px;
      }
      .sub_container {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        width: 100%;
        margin-top: 3px;
      }
      .sub_display_display {
        border-style: solid;
        border-width: 2px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        flex-direction: column;
        padding-bottom: 8px;
        border-top: none;
      }
      .subset {
        border-top-style: solid;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        border-top-width: 2px;
      }
      .button_row {
        background-color: rgb(232, 232, 232);
        border-left-style: solid;
        border-left-width: 2px;
        border-right-width: 2px;
        border-right-style: solid;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        border-top-width: 2px;
        border-top-style: solid;
        padding: 3px;
        display: flex;
        flex-wrap: nowrap;
        padding-left: max(2vw, 15px);
        padding-right: max(2vw, 15px);
      }
      .sub_button_row {
        margin-top: 4px;
        padding-left: 1vw;
        padding-right: 1vw;
        padding-top: 12px;
        margin-bottom: 4px;
        display: flex;
        justify-content: space-evenly;
      }
      .repeat_container {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
      }
      .repeat_flow {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        justify-content: center;
        padding-left: 8px;
        flex: 1 1 auto;
      }
      .right_side {
        flex: 1 1 auto;
      }
      .set_repeat {
        text-align: center;
        font-size: 3vh;
        width: 4vw;
        min-width: 52px;
        border-radius: var(--common-radius);
      }
      .element_row {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        width: 100%;
        padding-left: 8px;
        padding-right: 8px;
      }
      .element_top_part {
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        margin-top: 2px;
      }
      .element_bottom_part {
        display: flex;
        flex-wrap: nowrap;
        padding-left: 5.5vw;
        margin-top: 0.25vh;
      }
      .element_repeat {
        text-align: center;
        font-size: 2.25vh;
        width: 4vw;
        min-width: 52px;
        border-radius: var(--common-radius);
      }
      .extreme_bold {
        font-weight: 900;
      }
      .by {
        align-self: center;
        margin-right: 0.2vw;
        margin-left: 0.2vw;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .distance {
        text-align: center;
        font-size: 2.25vh;
        border-radius: var(--common-radius);
      }
      .distance::-webkit-inner-spin-button,
      .distance::-webkit-outer-spin-button {
        appearance: initial;
        -webkit-appearance: none;
        margin: 0;
        -moz-appearance: textfield;
      }
      .single_description {
        margin-left: 0.25vw;
        margin-right: 0.25vw;
        flex: 1 1 auto;
        border-radius: var(--common-radius);
      }
      .sendoff {
        width: 5vw;
        margin-right: 0.25vw;
        height: 100%;
        border-top-right-radius: var(--common-radius);
        border-bottom-right-radius: var(--common-radius);
        padding: 0px;
        text-align: center;
        border-width: 1px;
      }
      .middle_button {
        margin-left: 1px;
        margin-right: 1px;
      }
      .sendoff_wrapper {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
      }
      .sendoff_letter {
        background-color: lightblue;
        height: 100%;
        display: flex;
        align-items: center;
        border-color: darkblue;
        border-width: 1px;
        border-style: solid;
        padding-left: 6px;
        padding-right: 3px;
        border-top-left-radius: var(--common-radius);
        border-bottom-left-radius: var(--common-radius);
        border-right-style: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .inner_sendoff_number {
        height: 100%;
        border-top-width: 1px;
        background-color: lightcyan;
        border-top-color: darkblue;
        border-top-style: solid;
        border-bottom-style: solid;
        border-bottom-color: darkblue;
        border-bottom-width: 1px;
        border-left: none;
        border-right: none;
        width: 3vw;
        border-left-style: solid;
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        width: fit-content;
        border-left-width: 1px;
      }
      .sendoff_custom_number {
        white-space: nowrap;
        user-select: none;
      }
      .custom_arrow_wrapper {
        font-size: 0.7em;
      }
      .custom_up_down {
        cursor: default;
        user-select: none;
      }
      .custom_up_down:hover {
        background-color: darkblue;
        color: white;
      }
      .type_display {
        align-self: center;
        background-color: lightblue;
        border-style: solid;
        border-color: darkblue;
        border-width: 1px;
        padding-left: 6px;
        padding-right: 3px;
        border-top-left-radius: var(--common-radius);
        border-bottom-left-radius: var(--common-radius);
        display: flex;
        align-items: center;
        height: 100%;
        justify-content: flex-end;
        width: 5.5vw;
        user-select: none;
        text-align: right;
      }
      .multi-description {
        flex: 1 1 auto;
        margin-right: 0.25vw;
        border-top-right-radius: var(--common-radius);
        border-bottom-right-radius: var(--common-radius);
        border-left-style: none;
        border-width: 1px;
      }
      .description_wrapper {
        display: flex;
        flex: 1 1 auto;
      }
      .element_type_display {
        flex: 1 1 auto;
        display: flex;
        flex-wrap: wrap;
        align-content: center;
        justify-content: center;
      }
      .custom_description_numbers {
        height: 100%;
        background-color: lightblue;
        border-width: 0px;
        width: 5.5vw;
        text-align: right;
      }
      .main_button {
        margin-right: 1.5vw;
      }
      .background_blocker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(255, 255, 255, 0.4);
        -webkit-backdrop-filter: blur(8px);
        backdrop-filter: blur(8px);
        display: flex;
        justify-content: center;
        animation: fadeInAnimation ease 0.3s;
        animation-iteration-count: 1;
        animation-fill-mode: forwards;
        cursor: not-allowed;
      }
      .modal_wrapper {
        width: 80%;
        min-width: 80%;
        max-width: 97%;
        position: absolute;
        top: 0;
        margin-top: min(8%, 8vh);
        display: flex;
        flex-direction: column;
        cursor: default;
        overflow: hidden;
      }
      .modal_banner {
        padding: 3px;
        padding-left: max(12px, 2vw);
        padding-right: max(12px, 2vw);
        border-bottom: 2px;
        border-style: solid;
        border-top-left-radius: var(--modal-border-radius);
        border-top-right-radius: var(--modal-border-radius);
        background-color: white;
        display: flex;
        background-color: lightblue;
        align-items: center;
      }
      .modal_content {
        border-style: solid;
        border-top-style: none;
        padding-top: 4px;
        padding-left: max(12px, 2vw);
        padding-right: max(12px, 2vw);
        background-color: white;
        border-bottom-left-radius: var(--modal-border-radius);
        border-bottom-right-radius: var(--modal-border-radius);
        padding-bottom: 12px;
      }
      .close_modal_button {
        cursor: pointer;
        border-radius: 50%;
        background-color: rgb(73, 162, 192);
        height: 3ch;
        width: 3ch;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
      }
      .close_modal_button:hover {
        animation: changeToOverClose ease 0.2s;
        color: white;
        background-color: rgba(64, 64, 64, 0.4);
      }
      .close_modal_button:active:hover {
        color: black;
      }
      .modal_banner_text {
        flex: 1 1 auto;
      }
      @keyframes changeToOverClose {
        0% {
          color: black;
          background-color: rgb(73, 162, 192);
        }
        100% {
          color: white;
          background-color: rgba(64, 64, 64, 0.4);
        }
      }
      @keyframes fadeInAnimation {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
      .prevent-select {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
      }
      .label_table {
        display: table;
        width: 100%;
      }
      .table_row {
        display: table-row;
        width: 100%;
      }
      .table_cell_input {
        display: table-cell;
        width: 80%;
        padding-top: 12px;
      }
      .table_cell_label {
        display: table-cell;
        text-align: right;
        padding-right: 8px;
        align-content: center;
        padding-top: 12px;
      }
      .paperlike_text_input {
        border: none;
        border-bottom: solid;
        margin-bottom: 8px;
        border-color: lightgray;
        width: 100%;
        padding: 3px;
        padding-top: 0px;
      }
      textarea.paperlike_text_input {
        min-height: 4ch;
      }
      .description_container {
        margin-left: max(12px, 2vw);
        margin-right: max(12px, 2vw);
        display: flex;
        margin-bottom: 8px;
      }
      .set_description_label {
        background-color: lightblue;
        border-width: 1px;
        border-style: solid;
        border-top-left-radius: var(--common-radius);
        border-bottom-left-radius: var(--common-radius);
        padding-left: 8px;
        border-right: none;
        display: flex;
        align-content: center;
        justify-content: center;
        flex-wrap: wrap;
        user-select: none;
        padding-right: 3px;
      }
      .set_description_input {
        border-top-right-radius: var(--common-radius);
        border-bottom-right-radius: var(--common-radius);
        border-width: 1px;
        flex: 1 1 auto;
        padding-left: 4px;
        height: 1px;
      }
      .save_button_row {
        display: flex;
        margin-top: 20px;
        justify-content: space-evenly;
      }
      .error_message {
        color: red;
        text-align: center;
      }
      .setting_wraper {
        display: flex;
        align-items: center;
        margin-top: 8px;
      }

      .setting_wraper * {
        margin-left: 4px;
        margin-right: 4px;
      }
      .saving_status {
        color: green;
      }
      #practices_div {
        width: 50%;
        height: 90%;
        margin-left: 4vw;
        margin-top: 3vw;
        background-color: white;
        border-style: solid;
        border-color: darkgray;
        padding: 8px;
        border-radius: 8px;
        box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
        overflow: auto;
      }
      .practice_small_display:hover {
        cursor: pointer;
        background-color: rgb(166, 244, 255);
      }
      .practice_small_display {
        padding-left: 4px;
        padding-right: 4px;
        width: 100%;
        padding-top: 3px;
        border-radius: 3px;
        white-space: nowrap;
      }
    </style>
    <link rel="icon" href="../temp/stopwatch.svg" />
  </head>
  <body>
    <div id="full_screen">
      <div class="tab_row">
        <div
          id="set_tab"
          class="tab active_tab"
          onclick="switchToSetMaker(this)"
        >
          Set Maker
        </div>
        <div id="video_tab" class="tab" onclick="switchToVideoSetUp(this)">
          Video Set Up
        </div>
        <div
          id="practices_tab"
          class="tab"
          onclick="switchToPracticesTab(this)"
        >
          Practices
        </div>
        <div id="settings_tab" class="tab" onclick="switchToSettings(this)">
          Settings
        </div>
      </div>
      <div id="main_button_row" class="button_row">
        <button
          id="add_set_button"
          class="btn btn-primary main_button"
          onclick="addSet(this, 1)"
        >
          Add Set
        </button>
        <button
          id="save_set_button"
          type="button"
          class="btn btn-primary main_button"
          onclick="saveIndividualSetClicked(this)"
          style="visibility: hidden"
          disabled
        >
          Save As Indiviual Set
        </button>
        <button
          id="save_to_practice_button"
          class="btn btn-primary main_button"
          onclick="saveAsPracticeClicked(this)"
          style="visibility: hidden"
          disabled
        >
          Save As Practice
        </button>
        <button
          id="mockup_set_button"
          class="btn btn-danger main_button"
          onclick="mockUpSet(this)"
        >
          Mockup Set
        </button>
        <button
          id="test_set_button"
          class="btn btn-danger main_button"
          onclick="testSetClicked(this)"
        >
          Test Set
        </button>
      </div>
      <div id="set_display" class="display"></div>
      <div id="practices_display" class="display hide">
        <div id="practices_div"></div>
      </div>
      <div id="video_display" class="display hide"></div>
      <div id="settings_display" class="display hide">
        <div
          id="no_coach_id_error_message"
          class="error_message"
          style="display: none"
        >
          Coach ID Not found
        </div>
        <div
          id="invalid_coach_id_error_message"
          class="error_message"
          style="display: none"
        >
          Invalid Coach ID
        </div>
        <div class="setting_wraper">
          <label for="coach_id" id="coach_id_label">Coach ID:</label>
          <input
            id="coach_id"
            name="coach_id"
            type="text"
            placeholder="required"
            disabled="true"
          />
          <button
            id="edit_coach_id_button"
            type="button"
            class="btn btn-primary"
            onclick="editCoachIDButtonClicked()"
          >
            Edit Coach ID
          </button>
          <button
            id="save_coach_id_button"
            type="button"
            class="btn btn-success"
            style="display: none"
            onclick="saveCoachIDButtonclicked()"
          >
            Save Coach ID
          </button>
        </div>
      </div>
    </div>
    <div id="save_set_modal" class="background_blocker" style="display: none">
      <div class="modal_wrapper">
        <div class="modal_banner prevent-select">
          <div class="modal_banner_text">Save Set Individually</div>
          <div
            class="close_modal_button prevent-select"
            onclick="closeModal(this)"
          >
            X
          </div>
        </div>
        <div class="modal_content prevent-select">
          <div class="error_message" style="display: none">Error in set</div>
          <div class="label_table">
            <div class="table_row">
              <div class="table_cell_label">
                <label for="set_name">Set Name:</label>
              </div>
              <div class="table_cell_input">
                <input
                  id="set_name"
                  name="set_name"
                  class="paperlike_text_input"
                  type="text"
                  placeholder="required"
                />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="set_date">Date:</label>
              </div>
              <div class="table_cell_input">
                <input id="set_date" name="set_date" type="date" />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="set_key_words">Keywords:</label>
              </div>
              <div class="table_cell_input">
                <input
                  id="set_key_words"
                  name="set_key_words"
                  class="paperlike_text_input"
                  type="text"
                />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="set_short_description">Description:</label>
              </div>
              <div class="table_cell_input">
                <textarea
                  id="set_short_description"
                  name="set_short_description"
                  type="text"
                  class="paperlike_text_input"
                ></textarea>
              </div>
            </div>
          </div>
          <div class="save_button_row">
            <button class="btn btn-primary" onclick="saveIndivdualSet(this)">
              Save
            </button>
            <button
              class="btn btn-danger"
              onclick="closeModal(this.parentElement)"
            >
              Cancel
            </button>
          </div>
          <input id="set_id" type="hidden" />
        </div>
      </div>
    </div>
    <div
      id="save_practice_modal"
      class="background_blocker"
      style="display: none"
    >
      <div class="modal_wrapper">
        <div class="modal_banner prevent-select">
          <div class="modal_banner_text">Save Set Individually</div>
          <div
            class="close_modal_button prevent-select"
            onclick="closeModal(this)"
          >
            X
          </div>
        </div>
        <div class="modal_content prevent-select">
          <div class="error_message" style="display: none">
            Error in practice
          </div>
          <div class="label_table">
            <div class="table_row">
              <div class="table_cell_label">
                <label for="practice_number">Day's Practice Number:</label>
              </div>
              <div class="table_cell_input">
                <input
                  id="practice_number"
                  name="practice_number"
                  class="paperlike_text_input"
                  type="number"
                  placeholder="required"
                  value="1"
                  min="0"
                  max="10"
                />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="practice_group">Group:</label>
              </div>
              <div class="table_cell_input">
                <input
                  id="practice_group"
                  name="practice_group"
                  class="paperlike_text_input"
                  type="text"
                />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="practice_date">Date:</label>
              </div>
              <div class="table_cell_input">
                <input id="practice_date" name="practice_date" type="date" />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="practice_key_words">Keywords:</label>
              </div>
              <div class="table_cell_input">
                <input
                  id="practice_key_words"
                  name="practice_key_words"
                  class="paperlike_text_input"
                  type="text"
                />
              </div>
            </div>
            <div class="table_row">
              <div class="table_cell_label">
                <label for="practice_short_description">Description:</label>
              </div>
              <div class="table_cell_input">
                <textarea
                  id="practice_short_description"
                  name="practice_short_description"
                  type="text"
                  class="paperlike_text_input"
                ></textarea>
              </div>
            </div>
          </div>
          <div class="save_button_row">
            <button class="btn btn-primary" onclick="saveAsPractice(this)">
              Save
            </button>
            <button
              class="btn btn-danger"
              onclick="closeModal(this.parentElement)"
            >
              Cancel
            </button>
          </div>
          <div
            id="practice_saving_status"
            class="saving_status"
            style="display: none"
          ></div>
          <input id="practice_id" type="hidden" />
        </div>
      </div>
    </div>
  </body>

  <script>
    const COLOR_LIST = Object.freeze({
      1: "rgb(255, 160, 122)",
      2: "rgb(255, 215, 0)",
      3: "rgb(147, 112, 219)",
      4: "rgb(152, 251, 152)",
      5: "rgb(176, 196, 222)",
      6: "rgb(245, 245, 220)",
      7: "rgb(47, 79, 79)",
      8: "rgb(255, 218, 185)",
      9: "rgb(255, 182, 193)",
      10: "rgb(189, 183, 107)",
    });
    const MULTI_DESCRIPTION_TYPE = Object.freeze({
      BY_ROUND: 1,
      SPLIT_EVENLY: 2,
      REPEAT_ONE_AT_A_TIME: 3,
    });

    const ERROR_BACKGROUND_COLOR = "palevioletred";
    let mouse = false;
    document
      .getElementById("full_screen")
      .addEventListener("mousemove", mouseExists);

    document
      .getElementById("set_tab")
      .addEventListener("click", switchToSetMaker);

    document.getElementById("set_date").valueAsDate = new Date();
    document.getElementById("practice_date").valueAsDate = new Date();

    const dateInputs = document.getElementsByTagName("input");
    for (let i = 0; i < dateInputs.length; i++) {
      if ((dateInputs.type = "date")) {
        dateInputs[i].min = "2020-01-01";
        dateInputs[i].max = new Date().getFullYear() + 10 + "-12-31";
      }
    }

    if (!localStorage.getItem("coach_id")) coachIDNotFound();
    let COACH_ID = localStorage.getItem("coach_id");
    document.getElementById("coach_id").value = COACH_ID;

    loadPractices();

    function mouseExists(e) {
      mouse = true;
      let target = e.target;

      if (
        target.classList[0] != "inner_sendoff_number" &&
        target.classList[0] != "sendoff_custom_number" &&
        target.classList[0] != "custom_up_down" &&
        target.classList[0] != "inner_sendoff_number"
      ) {
        let wrappers = document.getElementsByClassName("custom_arrow_wrapper");
        for (let i = 0; i < wrappers.length; i++) {
          wrappers[i].style.display = "none";
          wrappers[i].parentElement.children[0].style.marginLeft = "";
          wrappers[i].parentElement.children[0].style.marginRight = "";
        }
      }
    }

    function coachIDNotFound() {
      document.getElementById("settings_tab").click();
      document.getElementById("coach_id").disabled = false;
      document.getElementById("no_coach_id_error_message").style.display = "";
      document.getElementById("edit_coach_id_button").style.display = "none";
      document.getElementById("save_coach_id_button").style.display = "";
    }

    function editCoachIDButtonClicked() {
      document.getElementById("coach_id").disabled = false;
      document.getElementById("edit_coach_id_button").style.display = "none";
      document.getElementById("save_coach_id_button").style.display = "";
    }

    function saveCoachIDButtonclicked() {
      let coach_id_input = document.getElementById("coach_id");
      let coachID = coach_id_input.value;
      coachID = coachID.trim();
      if (coachID.includes(" ") || coachID == "") {
        document.getElementById(
          "invalid_coach_id_error_message"
        ).style.display = "";
      } else {
        document.getElementById(
          "invalid_coach_id_error_message"
        ).style.display = "none";
        document.getElementById("no_coach_id_error_message").style.display =
          "none";

        COACH_ID = coachID;
        localStorage.setItem("coach_id", coachID);
        document.getElementById("edit_coach_id_button").style.display = "";
        document.getElementById("save_coach_id_button").style.display = "none";
        document.getElementById("coach_id").disabled = true;
      }
    }

    function addSet(e, sub_set_count) {
      let save_set_button = document.getElementById("save_set_button");
      save_set_button.disabled = false;
      save_set_button.style.visibility = "";

      let save_to_practice_button = document.getElementById(
        "save_to_practice_button"
      );
      save_to_practice_button.disabled = false;
      save_to_practice_button.style.visibility = "";

      const sub_display_div = document.createElement("div");
      sub_display_div.classList.add("sub_display");

      const sub_container = document.createElement("div");
      sub_container.classList.add("sub_container");
      if (sub_set_count == 1) sub_container.calculateTimes = calculateTimes;
      sub_display_div.appendChild(sub_container);

      const repeat_container = document.createElement("div");
      repeat_container.classList.add("repeat_container");
      sub_container.appendChild(repeat_container);

      const right_side = document.createElement("div");
      right_side.classList.add("right_side");
      sub_container.appendChild(right_side);

      const times_row = document.createElement("div");
      times_row.classList.add("times_row");
      times_row.style.backgroundColor =
        COLOR_LIST[sub_set_count % Object.keys(COLOR_LIST).length];
      if (sub_set_count > 1) {
        times_row.style.display = "none";
      }
      right_side.appendChild(times_row);

      const spacer = document.createElement("div");
      spacer.classList.add("spacer");
      spacer.innerText = "Set Times:";
      times_row.appendChild(spacer);

      const first_set_time = document.createElement("div");
      first_set_time.classList.add("set_time");
      first_set_time.innerText = "A: 00:00";
      times_row.appendChild(first_set_time);

      const first_tab = document.createElement("div");
      first_tab.classList.add("tab");
      first_tab.classList.add("active_tab");
      let sub_text = "";
      for (let i = 0; i < sub_set_count - 1; i++) sub_text += "Sub";
      first_tab.innerText = sub_text + "Set";

      const sub_display_display_div = document.createElement("div");
      sub_display_display_div.classList.add("sub_display");
      sub_display_display_div.classList.add("sub_display_display");
      sub_display_display_div.style.backgroundColor =
        COLOR_LIST[sub_set_count % Object.keys(COLOR_LIST).length];
      right_side.appendChild(sub_display_display_div);
      if (sub_set_count > 1) {
        sub_display_display_div.classList.add("subset");
      }

      const sub_button_row = document.createElement("div");
      sub_button_row.classList.add("sub_button_row");
      sub_display_display_div.appendChild(sub_button_row);

      const add_element_button = document.createElement("button");
      add_element_button.type = "button";
      add_element_button.classList.add("btn");
      add_element_button.classList.add("btn-primary");
      add_element_button.innerText = "Add Element";
      add_element_button.addEventListener("click", addElement);
      sub_button_row.appendChild(add_element_button);

      const add_set_repeat_button = document.createElement("button");
      add_set_repeat_button.type = "button";
      add_set_repeat_button.classList.add("btn");
      add_set_repeat_button.classList.add("btn-primary");
      add_set_repeat_button.innerText = "Add Set Repeat";
      add_set_repeat_button.addEventListener("click", addSetRepeat);
      sub_button_row.appendChild(add_set_repeat_button);

      const sub_button = document.createElement("button");
      sub_button.type = "button";
      sub_button.classList.add("btn");
      sub_button.classList.add("btn-primary");
      sub_button.innerText = "Add Subset";
      let new_subset_count = sub_set_count + 1;
      sub_button.addEventListener("click", (e) => {
        addSet(e, new_subset_count);
      });
      sub_button_row.appendChild(sub_button);

      const remove_sub_button = document.createElement("button");
      remove_sub_button.type = "button";
      remove_sub_button.classList.add("btn");
      remove_sub_button.classList.add("btn-danger");
      let remove_sub_text = "";
      for (let i = 0; i < sub_set_count - 1; i++) remove_sub_text += "Sub";
      first_tab.innerText = sub_text + "Set";
      remove_sub_button.innerText = "Remove " + remove_sub_text + "Set";
      remove_sub_button.innerText = "Remove this Set";
      remove_sub_button.addEventListener("click", removeSubSet);
      sub_button_row.appendChild(remove_sub_button);

      const add_set_descrption_button = document.createElement("button");
      add_set_descrption_button.type = "button";
      add_set_descrption_button.classList.add("btn");
      add_set_descrption_button.classList.add("btn-primary");
      add_set_descrption_button.innerText = "Add Set Description";
      add_set_descrption_button.addEventListener("click", addSetDescription);
      sub_button_row.appendChild(add_set_descrption_button);

      if (e.innerText == "Add Set")
        e.parentElement.parentElement.children[2].appendChild(sub_container);
      else e.target.parentElement.parentElement.appendChild(sub_container);

      add_set_repeat_button.style.display = "none";
      add_set_repeat_button.click();
    }

    function tabRowResized(e) {
      let element = e[0].target;
      let spacer = element.parentElement.parentElement.children[0].children[0];
      if (spacer) spacer.style.height = element.offsetHeight + "px";
    }

    function addSetRepeat(e) {
      let sender = e.target;

      sender.innerText = "Remove Set Repeat";
      sender.removeEventListener("click", addSetRepeat);
      sender.addEventListener("click", removeSetRepeat);
      sender.classList.remove("btn-primary");
      sender.classList.add("btn-danger");
      let repeat_container =
        sender.parentElement.parentElement.parentElement.parentElement
          .children[0];

      if (repeat_container.children.length == 0) {
        const repeat_container_spacer = document.createElement("div");
        let tab_row =
          sender.parentElement.parentElement.parentElement.children[0];
        repeat_container_spacer.style.height = tab_row.offsetHeight + "px";
        new ResizeObserver(tabRowResized).observe(tab_row);
        repeat_container.appendChild(repeat_container_spacer);

        const repeat_flow = document.createElement("div");
        repeat_flow.classList.add("repeat_flow");
        repeat_container.appendChild(repeat_flow);

        const repeat_input = document.createElement("input");
        repeat_input.classList.add("set_repeat");
        repeat_input.type = "number";
        repeat_input.min = 1;
        repeat_input.max = 99;
        repeat_input.value = 1;
        repeat_input.addEventListener("change", setRepeatChanged);
        repeat_flow.appendChild(repeat_input);

        const bracket_div = document.createElement("div");
        bracket_div.classList.add("by");
        bracket_div.innerText = "X";
        repeat_flow.appendChild(bracket_div);
      } else {
        repeat_container.style.display = "";
      }
    }

    function removeSetRepeat(event) {
      let repeat_container_two =
        event.target.parentElement.parentElement.parentElement.parentElement
          .children[0];

      event.target.removeEventListener("click", removeSetRepeat);
      event.target.addEventListener("click", addSetRepeat);
      event.target.innerText = "Add Set Repeat";
      event.target.classList.remove("btn-danger");
      event.target.classList.add("btn-primary");

      repeat_container_two.style.display = "none";
    }

    function removeSubSet(e) {
      let sub_container =
        e.target.parentElement.parentElement.parentElement.parentElement;
      sub_container.remove();
      if (document.getElementById("set_display").children.length == 0) {
        let save_individually_button =
          document.getElementById("save_set_button");
        save_set_button.disabled = true;
        save_set_button.style.visibility = "hidden";

        let save_to_practice_button = document.getElementById(
          "save_to_practice_button"
        );
        save_to_practice_button.disabled = true;
        save_to_practice_button.style.visibility = "hidden";
      }
    }

    function addElement(e) {
      let display = e.target.parentElement.parentElement;

      const element_row = document.createElement("div");
      element_row.classList.add("element_row");
      display.appendChild(element_row);

      const element_top_part = document.createElement("div");
      element_top_part.classList.add("element_top_part");
      element_row.appendChild(element_top_part);

      const element_repeat = document.createElement("input");
      element_repeat.classList.add("element_repeat");
      element_repeat.type = "number";
      element_repeat.min = 1;
      element_repeat.max = 99;
      element_repeat.value = 1;
      element_repeat.addEventListener("change", changeAllSendoffsToMainCount);
      element_top_part.appendChild(element_repeat);

      const element_times = document.createElement("div");
      element_times.classList.add("by");
      element_times.innerText = "X";
      element_top_part.appendChild(element_times);

      const element_distance = document.createElement("input");
      element_distance.classList.add("distance");
      element_distance.type = "number";
      element_distance.min = 1;
      element_distance.max = 9999;
      element_distance.value = 100;
      element_top_part.appendChild(element_distance);

      const element_description = document.createElement("input");
      element_description.type = "text";
      element_description.classList.add("single_description");
      element_description.placeholder = "   description";
      element_top_part.appendChild(element_description);

      const sendoff_wrapper = document.createElement("div");
      sendoff_wrapper.classList.add("sendoff_wrapper");
      element_top_part.appendChild(sendoff_wrapper);

      const sendoff_letter = document.createElement("div");
      sendoff_letter.classList.add("sendoff_letter");

      sendoff_letter.innerText = "A:";
      sendoff_wrapper.appendChild(sendoff_letter);

      const first_sendoff = document.createElement("input");
      first_sendoff.classList.add("sendoff");
      first_sendoff.placeholder = "time";
      first_sendoff.type = "text";
      first_sendoff.addEventListener("input", sendoffValueChanged);
      sendoff_wrapper.appendChild(first_sendoff);
      element_row.sendoffs_list = [first_sendoff];

      const add_sendoff_button = document.createElement("button");
      add_sendoff_button.type = "button";
      add_sendoff_button.classList.add("btn");
      add_sendoff_button.classList.add("btn-success");
      add_sendoff_button.classList.add("extreme_bold");
      add_sendoff_button.innerText = "+";
      add_sendoff_button.addEventListener("click", addSendOff);
      element_top_part.appendChild(add_sendoff_button);

      const delete_sendoff_button = document.createElement("button");
      delete_sendoff_button.type = "button";
      delete_sendoff_button.classList.add("btn");
      delete_sendoff_button.classList.add("btn-danger");
      delete_sendoff_button.classList.add("extreme_bold");
      delete_sendoff_button.classList.add("middle_button");
      delete_sendoff_button.innerText = "-";
      delete_sendoff_button.addEventListener("click", removeLastSendoff);
      delete_sendoff_button.style.visibility = "hidden";
      element_top_part.appendChild(delete_sendoff_button);

      const multi_description_button = document.createElement("button");
      multi_description_button.classList.add("btn");
      multi_description_button.classList.add("btn-primary");
      multi_description_button.classList.add("middle_button");
      multi_description_button.innerText = "✱";
      multi_description_button.addEventListener("click", changeToMultiType);
      element_top_part.appendChild(multi_description_button);

      const delete_element_button = document.createElement("button");
      delete_element_button.type = "button";
      delete_element_button.classList.add("btn");
      delete_element_button.classList.add("btn-danger");
      delete_element_button.classList.add("extreme_bold");
      delete_element_button.innerText = "x";
      delete_element_button.addEventListener("click", deleteElement);
      element_top_part.appendChild(delete_element_button);

      const element_bottom_part = document.createElement("div");
      element_bottom_part.classList.add("element_bottom_part");
      element_row.appendChild(element_bottom_part);

      calculateTimes(element_row.parentElement.parentElement.parentElement);
    }

    function addSendOff(e) {
      let element_row = e.target.parentElement;
      let actual_element_row = element_row.parentElement;

      let letter = String.fromCharCode(
        element_row.children.length - 8 + 64 + 1
      ).toUpperCase();

      const sendoff_wrapper = document.createElement("div");
      sendoff_wrapper.classList.add("sendoff_wrapper");
      element_row.insertBefore(
        sendoff_wrapper,
        element_row.children[element_row.children.length - 4]
      );

      const sendoff_letter = document.createElement("div");
      sendoff_letter.classList.add("sendoff_letter");
      sendoff_letter.innerText = letter + ":";
      sendoff_wrapper.appendChild(sendoff_letter);

      const sendoff_number_wrapper = document.createElement("div");
      sendoff_number_wrapper.classList.add("inner_sendoff_number");
      sendoff_number_wrapper.addEventListener("mousemove", displayCustomUpDown);
      sendoff_number_wrapper.addEventListener(
        "mouseenter",
        displayCustomUpDown
      );
      sendoff_wrapper.appendChild(sendoff_number_wrapper);

      const sendoff_custom_number = document.createElement("div");
      sendoff_custom_number.classList.add("sendoff_custom_number");
      if (element_row.children.length == 10)
        sendoff_custom_number.innerText = element_row.children[0].value + " x";
      else
        sendoff_custom_number.innerText =
          element_row.children[
            element_row.children.length - 6
          ].children[1].children[0].innerText.split(" ")[0] + " x";
      sendoff_number_wrapper.appendChild(sendoff_custom_number);

      const custom_arrow_wrapper = document.createElement("div");
      custom_arrow_wrapper.classList.add("custom_arrow_wrapper");
      if (mouseExists) custom_arrow_wrapper.style.display = "none";
      sendoff_number_wrapper.appendChild(custom_arrow_wrapper);

      const custom_up = document.createElement("div");
      custom_up.classList.add("custom_up_down");
      custom_up.innerText = "▲";
      custom_up.addEventListener("click", customUpClicked);
      custom_arrow_wrapper.appendChild(custom_up);

      const custom_down = document.createElement("div");
      custom_down.classList.add("custom_up_down");
      custom_down.innerText = "▼";
      custom_down.addEventListener("click", customDownClicked);
      custom_arrow_wrapper.appendChild(custom_down);

      const first_sendoff = document.createElement("input");
      first_sendoff.classList.add("sendoff");
      first_sendoff.placeholder = "time";
      first_sendoff.type = "text";
      first_sendoff.addEventListener("input", sendoffValueChanged);
      sendoff_wrapper.appendChild(first_sendoff);
      actual_element_row.sendoffs_list.push(first_sendoff);

      element_row.children[element_row.children.length - 3].style.visibility =
        "";
      calculateTimes(
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement
      );
    }

    function removeLastSendoff(e) {
      if (e.target.parentElement.children.length > 9)
        e.target.parentElement.children[
          e.target.parentElement.children.length - 5
        ].remove();

      if (e.target.parentElement.children.length == 9)
        e.target.parentElement.children[
          e.target.parentElement.children.length - 5
        ].disabled = true;

      if (this.parentElement.children.length == 9)
        this.style.visibility = "hidden";
      calculateTimes(
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement
      );
    }

    function customUpClicked(e) {
      let number_display = e.target.parentElement.parentElement.children[0];
      let number = parseInt(number_display.innerText.split(" ")[0]);
      if (number < 99) number++;
      number_display.innerText = number + " x";
      let set =
        number_display.parentElement.parentElement.parentElement.parentElement
          .parentElement.parentElement.parentElement;
      calculateTimes(set);
    }

    function customDownClicked(e) {
      let number_display = e.target.parentElement.parentElement.children[0];
      let number = parseInt(number_display.innerText.split(" ")[0]);
      if (number > 1) number--;
      number_display.innerText = number + " x";
      let set =
        number_display.parentElement.parentElement.parentElement.parentElement
          .parentElement.parentElement.parentElement;
      calculateTimes(set);
    }

    function displayCustomUpDown(e) {
      try {
        if (this.classList[0] == "sendoff_wrapper") {
          this.children[1].children[1].style.display = "";
          this.children[1].children[0].style.marginLeft = "4px";
          this.children[1].children[0].style.marginRight = "4px";
        } else {
          this.children[1].style.display = "";
          this.children[0].style.marginLeft = "4px";
          this.children[0].style.marginRight = "4px";
        }
      } catch {}
    }

    function deleteElement(e) {
      for (let i = this.parentElement.children.length - 5; i > 4; i--)
        this.parentElement.parentElement.sendoffs_list = removeFromList(
          this.parentElement.parentElement.sendoffs_list,
          this.parentElement.children[i].children[2]
        );

      this.parentElement.parentElement.sendoffs_list = removeFromList(
        this.parentElement.parentElement.sendoffs_list,
        this.parentElement.children[4].children[1]
      );
      let main_set =
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement;
      this.parentElement.parentElement.remove();
      calculateTimes(main_set);
    }

    function changeToMultiType(e) {
      let element_row = this.parentElement.parentElement;
      if (this.innerText != "✱") return "";
      const upper_row = this.parentElement;
      upper_row.parentElement.multi_description_type =
        MULTI_DESCRIPTION_TYPE.SPLIT_EVENLY;
      const lower_row = this.parentElement.parentElement.children[1];

      upper_row.children[0].removeEventListener(
        "change",
        changeAllSendoffsToMainCount
      );

      //description box
      upper_row.children[0].addEventListener("change", elementRepeatChanged);
      upper_row.children[3].style.display = "none";
      for (let i = 4; i < upper_row.children.length - 5; i++)
        upper_row.children[i].style.display = "none";
      //upper_row.children[upper_row.children.length - 6].style.visibility = "hidden";
      upper_row.children[upper_row.children.length - 5].style.visibility =
        "hidden";
      upper_row.children[upper_row.children.length - 4].style.visibility =
        "hidden";
      upper_row.children[upper_row.children.length - 3].style.visibility =
        "hidden";
      upper_row.children[upper_row.children.length - 2].innerText =
        "Change type";
      upper_row.children[upper_row.children.length - 2].removeEventListener(
        "click",
        addSendOff
      );
      upper_row.children[upper_row.children.length - 2].addEventListener(
        "click",
        changeTypeClicked
      );
      upper_row.children[upper_row.children.length - 1].innerText =
        "Add Description";
      upper_row.children[upper_row.children.length - 1].classList.remove(
        "btn-danger"
      );
      upper_row.children[upper_row.children.length - 1].classList.remove(
        "extreme_bold"
      );
      upper_row.children[upper_row.children.length - 1].classList.add(
        "btn-success"
      );
      upper_row.children[upper_row.children.length - 1].removeEventListener(
        "click",
        deleteElement
      );
      upper_row.children[upper_row.children.length - 1].addEventListener(
        "click",
        addDescriptionClicked
      );

      const element_type_display = document.createElement("div");
      element_type_display.classList.add("element_type_display");
      element_type_display.innerText = "Do below one time through";
      upper_row.insertBefore(element_type_display, upper_row.children[3]);

      const description_wrapper = document.createElement("div");
      description_wrapper.classList.add("description_wrapper");
      lower_row.appendChild(description_wrapper);

      const type_display = document.createElement("input");
      type_display.type = "text";
      type_display.classList.add("type_display");
      if (upper_row.children[0].value == 1) type_display.value = "1:";
      else type_display.value = "1-" + upper_row.children[0].value + ":";
      type_display.addEventListener("change", addColon);
      type_display.addEventListener("input", recolorOnInvalidInput);
      description_wrapper.appendChild(type_display);
      element_row.type_display_list = [type_display];

      const temp = document.createElement("input");
      temp.classList.add("multi-description");
      temp.type = "text";
      description_wrapper.appendChild(temp);

      const sendoff_wrapper = document.createElement("div");
      sendoff_wrapper.classList.add("sendoff_wrapper");
      lower_row.appendChild(sendoff_wrapper);

      const sendoff_letter = document.createElement("div");
      sendoff_letter.classList.add("sendoff_letter");

      sendoff_letter.innerText = "A:";
      sendoff_wrapper.appendChild(sendoff_letter);

      const first_sendoff = document.createElement("input");
      first_sendoff.classList.add("sendoff");
      first_sendoff.placeholder = "time";
      first_sendoff.type = "text";
      first_sendoff.addEventListener("input", sendoffValueChanged);
      sendoff_wrapper.appendChild(first_sendoff);
      element_row.sendoffs_list.push(first_sendoff);

      const add_sendoff_button = document.createElement("button");
      add_sendoff_button.type = "button";
      add_sendoff_button.classList.add("btn");
      add_sendoff_button.classList.add("btn-success");
      add_sendoff_button.classList.add("extreme_bold");
      add_sendoff_button.innerText = "+";
      add_sendoff_button.addEventListener("click", addDescriptionSendoff);
      lower_row.appendChild(add_sendoff_button);

      const delete_sendoff_button = document.createElement("button");
      delete_sendoff_button.type = "button";
      delete_sendoff_button.classList.add("btn");
      delete_sendoff_button.classList.add("btn-danger");
      delete_sendoff_button.classList.add("extreme_bold");
      delete_sendoff_button.classList.add("middle_button");
      delete_sendoff_button.innerText = "-";
      delete_sendoff_button.addEventListener("click", removeDescriptionSendoff);
      delete_sendoff_button.style.visibility = "hidden";
      lower_row.appendChild(delete_sendoff_button);

      const delete_element_button = document.createElement("button");
      delete_element_button.type = "button";
      delete_element_button.classList.add("btn");
      delete_element_button.classList.add("btn-danger");
      delete_element_button.classList.add("extreme_bold");
      delete_element_button.innerText = "x";
      delete_element_button.addEventListener("click", deleteDescription);
      lower_row.appendChild(delete_element_button);

      calculateTimes(element_row.parentElement.parentElement.parentElement);
    }

    function elementRepeatChanged(e) {
      if (
        this.parentElement.parentElement.multi_description_type ==
        MULTI_DESCRIPTION_TYPE.BY_ROUND
      ) {
        calculateTimes(
          this.parentElement.parentElement.parentElement.parentElement
            .parentElement
        );
        return 0;
      }

      let value = parseInt(this.value);
      if (
        parseInt(this.value) <
        this.parentElement.parentElement.children.length - 1
      )
        this.value = this.parentElement.parentElement.children.length - 1;
      redoDescriptionSpread(this.parentElement.parentElement);

      let set_working_on =
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement;
      calculateTimes(set_working_on);
    }

    function redoDescriptionSpread(element_row) {
      element_row.descriptions_valid = true;
      const number_of_descriptions = element_row.children.length - 1;
      const repeats = parseInt(element_row.children[0].children[0].value);
      if (
        element_row.multi_description_type ==
        MULTI_DESCRIPTION_TYPE.SPLIT_EVENLY
      ) {
        let step = repeats / number_of_descriptions;
        step = Math.trunc(step);
        if (step < 1) step = 1;
        let remainder = repeats - number_of_descriptions * step;
        if (remainder < 0) remainder = 0;
        let first_number = 1;
        let last_number = 1 + step - 1;
        for (let i = 1; i < element_row.children.length; i++) {
          let remainder_used = false;
          if (remainder > 0) {
            last_number++;
            remainder--;
            remainder_used = true;
          }
          if (first_number != last_number)
            if (first_number > last_number)
              element_row.children[i].children[0].children[0].value = "?:";
            else {
              element_row.children[i].children[0].children[0].value =
                first_number + "-" + last_number + ":";
            }
          else
            element_row.children[i].children[0].children[0].value =
              first_number + ":";

          first_number = first_number + step;
          last_number = last_number + step;
          if (remainder_used) {
            first_number++;
          }
          if (first_number > repeats) first_number = last_number + 1;
        }
      } else if (
        element_row.multi_description_type ==
        MULTI_DESCRIPTION_TYPE.REPEAT_ONE_AT_A_TIME
      ) {
        let number_working_on = 1;
        for (let i = 1; i < number_of_descriptions + 1; i++) {
          if (number_working_on <= repeats)
            element_row.children[i].children[0].children[0].value =
              number_working_on + ":";
          else element_row.children[i].children[0].children[0].value = "?:";
          number_working_on++;
        }
      } else if (
        element_row.multi_description_type == MULTI_DESCRIPTION_TYPE.BY_ROUND
      ) {
        let set_reps = parseInt(
          element_row.parentElement.parentElement.parentElement.children[0]
            .children[1].children[0].value
        );

        let number_working_on = 1;
        for (let i = 1; i < number_of_descriptions + 1; i++) {
          if (number_working_on <= set_reps)
            element_row.children[i].children[0].children[0].value =
              "RD " + number_working_on + ":";
          else element_row.children[i].children[0].children[0].value = "?:";
          number_working_on++;
        }
      }

      //first row set, now copy to additonal sendoffs
      for (let i = 1; i < number_of_descriptions + 1; i++) {
        let value = element_row.children[i].children[0].children[0].value;
        let description_row = element_row.children[i];
        for (let j = description_row.children.length - 4; j > 1; j--) {
          description_row.children[j].children[1].children[0].value = value;
        }
      }

      //check for ? entries
      for (let i = 1; i < number_of_descriptions + 1; i++) {
        if (
          element_row.children[i].children[0].children[0].value.includes("?")
        ) {
          element_row.children[
            i
          ].children[0].children[0].style.backgroundColor =
            ERROR_BACKGROUND_COLOR;
          element_row.descriptions_valid = false;
        } else
          element_row.children[
            i
          ].children[0].children[0].style.backgroundColor = "";
        let description_row = element_row.children[i];
        for (let j = description_row.children.length - 4; j > 1; j--) {
          if (
            description_row.children[j].children[1].children[0].value.includes(
              "?"
            )
          ) {
            description_row.children[
              j
            ].children[1].children[0].style.backgroundColor =
              ERROR_BACKGROUND_COLOR;
            element_row.descriptions_valid = false;
          } else
            description_row.children[
              j
            ].children[1].children[0].style.backgroundColor = "";
        }
      }
    }

    function addDescriptionClicked(e) {
      const element_row = this.parentElement.parentElement;
      const upper_row = element_row.children[0];

      const lower_row = document.createElement("div");
      lower_row.classList.add("element_bottom_part");
      element_row.appendChild(lower_row);

      const description_wrapper = document.createElement("div");
      description_wrapper.classList.add("description_wrapper");
      lower_row.appendChild(description_wrapper);

      const type_display = document.createElement("input");
      type_display.classList.add("type_display");
      type_display.addEventListener("change", addColon);
      type_display.addEventListener("input", recolorOnInvalidInput);
      //if (upper_row.children[0].value == 1) type_display.value = "1:";
      //else type_display.value = "1-" + upper_row.children[0].value + ":";
      description_wrapper.appendChild(type_display);
      element_row.type_display_list.push(type_display);

      const temp = document.createElement("input");
      temp.classList.add("multi-description");
      temp.type = "text";
      description_wrapper.appendChild(temp);

      const sendoff_wrapper = document.createElement("div");
      sendoff_wrapper.classList.add("sendoff_wrapper");
      lower_row.appendChild(sendoff_wrapper);

      const sendoff_letter = document.createElement("div");
      sendoff_letter.classList.add("sendoff_letter");

      sendoff_letter.innerText = "A:";
      sendoff_wrapper.appendChild(sendoff_letter);

      const first_sendoff = document.createElement("input");
      first_sendoff.classList.add("sendoff");
      first_sendoff.placeholder = "time";
      first_sendoff.type = "text";
      first_sendoff.addEventListener("input", sendoffValueChanged);
      sendoff_wrapper.appendChild(first_sendoff);
      element_row.sendoffs_list.push(first_sendoff);

      const add_sendoff_button = document.createElement("button");
      add_sendoff_button.type = "button";
      add_sendoff_button.classList.add("btn");
      add_sendoff_button.classList.add("btn-success");
      add_sendoff_button.classList.add("extreme_bold");
      add_sendoff_button.innerText = "+";
      add_sendoff_button.addEventListener("click", addDescriptionSendoff);
      lower_row.appendChild(add_sendoff_button);

      const delete_sendoff_button = document.createElement("button");
      delete_sendoff_button.type = "button";
      delete_sendoff_button.classList.add("btn");
      delete_sendoff_button.classList.add("btn-danger");
      delete_sendoff_button.classList.add("extreme_bold");
      delete_sendoff_button.classList.add("middle_button");
      delete_sendoff_button.innerText = "-";
      delete_sendoff_button.addEventListener("click", removeDescriptionSendoff);
      delete_sendoff_button.style.visibility = "hidden";
      lower_row.appendChild(delete_sendoff_button);

      const delete_element_button = document.createElement("button");
      delete_element_button.type = "button";
      delete_element_button.classList.add("btn");
      delete_element_button.classList.add("btn-danger");
      delete_element_button.classList.add("extreme_bold");
      delete_element_button.innerText = "x";
      delete_element_button.addEventListener("click", deleteDescription);
      lower_row.appendChild(delete_element_button);

      redoDescriptionSpread(element_row);

      const last_row_before_this =
        element_row.children[element_row.children.length - 2];
      let number_of_clicks = last_row_before_this.children.length - 5;
      for (let i = 0; i < number_of_clicks; i++) {
        add_sendoff_button.click();
      }

      calculateTimes(element_row.parentElement.parentElement.parentElement);
    }

    function addDescriptionSendoff(e) {
      let element_row = e.target.parentElement;
      let actual_sendoff_row = element_row.parentElement;
      element_row.sendoffs_valid = true;

      let letter = String.fromCharCode(
        element_row.children.length - 4 + 64 + 1
      ).toUpperCase();

      const sendoff_wrapper = document.createElement("div");
      sendoff_wrapper.classList.add("sendoff_wrapper");
      element_row.insertBefore(
        sendoff_wrapper,
        element_row.children[element_row.children.length - 3]
      );

      const sendoff_letter = document.createElement("div");
      sendoff_letter.classList.add("sendoff_letter");
      sendoff_letter.innerText = letter + ":";
      sendoff_wrapper.appendChild(sendoff_letter);

      const sendoff_number_wrapper = document.createElement("div");
      sendoff_number_wrapper.classList.add("inner_sendoff_number");
      sendoff_wrapper.appendChild(sendoff_number_wrapper);

      const custom_description_numbers = document.createElement("input");
      custom_description_numbers.type = "text";
      custom_description_numbers.classList.add("custom_description_numbers");
      custom_description_numbers.addEventListener(
        "input",
        recolorOnInvalidInput
      );
      custom_description_numbers.value =
        element_row.children[0].children[0].value;
      if (custom_description_numbers.value.includes("?")) {
        custom_description_numbers.style.backgroundColor =
          ERROR_BACKGROUND_COLOR;
        element_row.sendoffs_valid = false;
      }
      custom_description_numbers.addEventListener("change", addColon);
      sendoff_number_wrapper.appendChild(custom_description_numbers);
      actual_sendoff_row.type_display_list.push(custom_description_numbers);

      const first_sendoff = document.createElement("input");
      first_sendoff.classList.add("sendoff");
      first_sendoff.placeholder = "time";
      first_sendoff.type = "text";
      first_sendoff.addEventListener("input", sendoffValueChanged);
      sendoff_wrapper.appendChild(first_sendoff);
      actual_sendoff_row.sendoffs_list.push(first_sendoff);

      element_row.children[element_row.children.length - 2].style.visibility =
        "";

      calculateTimes(
        element_row.parentElement.parentElement.parentElement.parentElement
      );
    }

    function removeDescriptionSendoff(e) {
      this.parentElement.parentElement.sendoffs_list = removeFromList(
        this.parentElement.parentElement.sendoffs_list,
        this.parentElement.children[this.parentElement.children.length - 4]
          .children[2]
      );

      this.parentElement.parentElement.type_display_list = removeFromList(
        this.parentElement.parentElement.type_display_list,
        this.parentElement.children[this.parentElement.children.length - 4]
          .children[1].children[0]
      );

      this.parentElement.children[
        this.parentElement.children.length - 4
      ].remove();
      if (this.parentElement.children.length == 5)
        this.style.visibility = "hidden";

      calculateTimes(
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement
      );
    }

    function deleteDescription(e) {
      const element_row = this.parentElement.parentElement;
      //delete all sendoffs from list
      for (let i = this.parentElement.children.length - 4; i > 1; i--) {
        element_row.sendoffs_list = removeFromList(
          element_row.sendoffs_list,
          this.parentElement.children[i].children[2]
        );
        element_row.type_display_list = removeFromList(
          element_row.type_display_list,
          this.parentElement.children[i].children[1].children[0]
        );
      }
      element_row.sendoffs_list = removeFromList(
        element_row.sendoffs_list,
        this.parentElement.children[1].children[2]
      );
      element_row.type_display_list = removeFromList(
        element_row.type_display_list,
        this.parentElement.children[0].children[0]
      );

      this.parentElement.remove();
      if (element_row.children.length == 1) {
        const upper_row = element_row.children[0];
        upper_row.children[3].remove();
        upper_row.children[0].removeEventListener(
          "change",
          elementRepeatChanged
        );
        upper_row.children[0].addEventListener(
          "change",
          changeAllSendoffsToMainCount
        );
        upper_row.children[3].style.display = "";

        for (let i = 4; i < upper_row.children.length; i++) {
          upper_row.children[i].style.visibility = "";
          upper_row.children[i].style.display = "";
        }

        upper_row.children[upper_row.children.length - 2].innerText = "✱";
        upper_row.children[upper_row.children.length - 2].addEventListener(
          "click",
          addSendOff
        );
        upper_row.children[upper_row.children.length - 2].removeEventListener(
          "click",
          addDescriptionSendoff
        );
        upper_row.children[upper_row.children.length - 1].innerText = "x";
        upper_row.children[upper_row.children.length - 1].classList.add(
          "btn-danger"
        );
        upper_row.children[upper_row.children.length - 1].classList.add(
          "extreme_bold"
        );
        upper_row.children[upper_row.children.length - 1].classList.remove(
          "btn-success"
        );
        upper_row.children[upper_row.children.length - 1].addEventListener(
          "click",
          deleteElement
        );
        upper_row.children[upper_row.children.length - 1].removeEventListener(
          "click",
          addDescriptionClicked
        );

        const element_bottom_part = document.createElement("div");
        element_bottom_part.classList.add("element_bottom_part");
        element_row.appendChild(element_bottom_part);
      } else redoDescriptionSpread(element_row);

      calculateTimes(element_row.parentElement.parentElement.parentElement);
    }

    function changeAllSendoffsToMainCount(e) {
      let reps = this.value;
      for (let i = this.parentElement.children.length - 5; i > 4; i--) {
        let sendoff_wrapper = this.parentElement.children[i];
        sendoff_wrapper.children[1].children[0].innerText = reps + " x";
      }
      if (
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement.calculateTimes
      ) {
        try {
          calculateTimes(
            this.parentElement.parentElement.parentElement.parentElement
              .parentElement
          );
        } catch {
          recolorCalculatedSendoffsToError(
            this.parentElement.parentElement.parentElement.parentElement
              .parentElement
          );
        }
      }
    }

    function changeTypeClicked(e) {
      const element_row = this.parentElement.parentElement;

      element_row.multi_description_type++;
      if (
        element_row.multi_description_type >
        Object.keys(MULTI_DESCRIPTION_TYPE).length
      )
        element_row.multi_description_type = 1;

      let element_type_display = element_row.children[0].children[3];
      switch (element_row.multi_description_type) {
        case MULTI_DESCRIPTION_TYPE.BY_ROUND:
          element_type_display.innerText = "Do each line once BY ROUND";
          break;
        case MULTI_DESCRIPTION_TYPE.REPEAT_ONE_AT_A_TIME:
          element_type_display.innerText =
            "Repeat below one time each line until finished";
          break;
        case MULTI_DESCRIPTION_TYPE.SPLIT_EVENLY:
          element_type_display.innerText = "Do below one time through";
          break;
      }

      redoDescriptionSpread(element_row);
      calculateTimes(
        this.parentElement.parentElement.parentElement.parentElement
          .parentElement
      );
    }

    function setRepeatChanged(e) {
      //need to check if any elements are multi elements, this only checks the first one
      let element_row =
        this.parentElement.parentElement.parentElement.children[1].children[1]
          .children[1];
      if (element_row)
        if (
          element_row.multi_description_type == MULTI_DESCRIPTION_TYPE.BY_ROUND
        )
          redoDescriptionSpread(element_row);

      let set = this.parentElement.parentElement.parentElement;

      calculateTimes(set);
    }

    function containsOnlyNumbers(str) {
      if (str == "") return true;
      return /^\d+$/.test(str);
    }

    function sendoffValueChanged(e) {
      let valid = true;
      let value = this.value.trim();
      let colon_added = false;
      let element_row = this.parentElement.parentElement.parentElement;

      if (value != "") {
        if (value.length > 2 && !value.includes(":")) {
          value =
            value.substring(0, value.length - 2) +
            ":" +
            value.substring(value.length - 2, value.length);
          colon_added = true;
        } else if (value.length > 2 && value.includes(":")) {
          let split_string = value.split(":");
          if (split_string.length > 2) {
            valid = false;
          } else {
            if (split_string[1].length < 2) {
              valid = false;
            } else if (split_string[1].length > 2) {
              split_string[0] =
                split_string[0] +
                split_string[1].substring(0, split_string[1].length - 2);
              split_string[1] = split_string[1].substring(
                split_string[1].length - 2,
                split_string[1].length
              );
              value = split_string[0] + ":" + split_string[1];
              colon_added = true;
            }
          }
        }
        let split_string = value.split(":");
        let before_colon = 0;
        let after_colon = "";

        if (split_string.length > 2) {
          valid = false;
        } else {
          if (split_string.length == 2) {
            before_colon = split_string[0];
            after_colon = split_string[1];
            if (
              !containsOnlyNumbers(before_colon) ||
              !containsOnlyNumbers(after_colon)
            )
              valid = false;
            else {
              if (!before_colon == "") {
                before_colon = parseInt(before_colon);
              }
              after_colon = parseInt(after_colon);
            }
          } else after_colon = parseInt(split_string[0]);
          if (
            !typeof before_colon == "number" ||
            !!typeof after_colon == "number"
          )
            valid = false;
          else {
            if (
              before_colon < 0 ||
              before_colon > 99 ||
              after_colon < 0 ||
              after_colon > 59
            )
              valid = false;
          }
        }

        if (isNaN(before_colon) || isNaN(after_colon)) {
          if (!split_string[1].startsWith("0")) {
            valid = false;
          }
        }
        if (value == "") {
          valid = true;
        }
        if (value == ":") {
          valid = false;
        }
        if (value.startsWith(":"))
          if (after_colon < 10 && split_string[1].length != 2) {
            valid = false;
          }
        if (valid && containsOnlyNumbers(value)) {
          value = ":" + value;
          colon_added = true;
        }
      }

      if (!valid) {
        this.style.backgroundColor = ERROR_BACKGROUND_COLOR;
        this.valid_sendoff = false;
      } else {
        this.style.backgroundColor = "";
        this.valid_sendoff = true;
        if (colon_added) this.value = value;
        calculateTimes(
          this.parentElement.parentElement.parentElement.parentElement
            .parentElement.parentElement
        );
      }

      if (value == "") {
        this.valid_sendoff = false;
      }
    }

    function addColon(e) {
      if (!this.value.includes(":")) this.value = this.value + ":";
    }

    function recolorOnInvalidInput(e) {
      // let element_row = this.parentElement.parentElement.parentElement;
      // this.value = this.value.toUpperCase();
      // let multi_description_type =
      //   this.parentElement.parentElement.parentElement.multi_description_type;
      // let max_reps = parseInt(
      //   this.parentElement.parentElement.parentElement.children[0].children[0]
      //     .value
      // );
      // if (multi_description_type == MULTI_DESCRIPTION_TYPE.BY_ROUND)
      //   max_reps = parseInt(
      //     this.parentElement.parentElement.parentElement.parentElement
      //       .parentElement.parentElement.children[0].children[1].children[0]
      //       .value
      //   );

      let element_row =
        this.parentElement.parentElement.parentElement.parentElement;
      let multi_description_type = element_row.multi_description_type;
      let max_reps;
      if (multi_description_type == MULTI_DESCRIPTION_TYPE.BY_ROUND)
        max_reps = parseInt(
          element_row.parentElement.parentElement.parentElement.parentElement
            .children[0].children[1].children[0].value
        );
      else
        max_reps = parseInt(
          this.parentElement.parentElement.parentElement.parentElement
            .children[0].children[0].value
        );

      if (
        _isValidDescriptionNumbers(this.value, multi_description_type, max_reps)
      ) {
        this.style.backgroundColor = "";
        this.description_valid = true;
        calculateTimes(element_row.parentElement.parentElement.parentElement);
      } else {
        this.style.backgroundColor = ERROR_BACKGROUND_COLOR;
        this.description_valid = false;
      }
    }

    function checkforValidDescriptionNumbers(element) {
      let element_row;

      if (element.classList[0] == "type_display")
        element_row = element.parentElement.parentElement.parentElement;
      else {
        element_row =
          element.parentElement.parentElement.parentElement.parentElement;
      }

      let type = element_row.multi_description_type;
      let max_reps = parseInt(element_row.children[0].children[0].value);

      if (type == MULTI_DESCRIPTION_TYPE.SPLIT_EVENLY) {
        let temp = element.value;

        let result = _isValidDescriptionNumbers(temp, type, max_reps);
        return result;
        temp = temp.replace(/\s/g, "");
        if (temp.endsWith(":")) temp = temp.replace(":", "");

        /*if (temp.includes("-")) {
          let split = temp.split("-");
          if (split.length != 2) return false;
          if (
            split[0].trim() == "" ||
            split[1].trim() == "" ||
            split[0].trim() == "0" ||
            split[1].trim() == "0"
          )
            return false;
          return (
            containsOnlyNumbers(split[0].trim()) &&
            containsOnlyNumbers(split[1].trim())
          );
        } else {
          return containsOnlyNumbers(temp.trim());
        }*/
      } else if (type == MULTI_DESCRIPTION_TYPE.REPEAT_ONE_AT_A_TIME) {
        let temp = element.value;
        if (temp.endsWith(":")) temp = temp.replace(":", "");
        return containsOnlyNumbers(temp);
      } else if (type == MULTI_DESCRIPTION_TYPE.BY_ROUND) {
        if (!element.value.startsWith("RD") && !element.value.startsWith("RD "))
          return false;
        else {
          let temp = element.value;
          temp.startsWith("RD ")
            ? (temp = temp.replace("RD ", ""))
            : (temp = temp.replace("RD", ""));
          if (temp.endsWith(":")) temp = temp.replace(":", "");
          temp = temp.trim();
          if (temp == "") return false;
          return containsOnlyNumbers(temp);
        }
      }
    }

    function switchToTab(tab_to_switch_to, display_to_switch_to) {
      let tabs = document.getElementsByClassName("tab");
      for (let i = 0; i < tabs.length; i++) {
        if (tabs[i] == tab_to_switch_to) tabs[i].classList.add("active_tab");
        else tabs[i].classList.remove("active_tab");
      }
      let displays = document.getElementsByClassName("display");
      for (let i = 0; i < displays.length; i++) {
        if (displays[i] == display_to_switch_to)
          displays[i].classList.remove("hide");
        else displays[i].classList.add("hide");
      }
      hideAllButtonsInButtonRow();
    }

    function hideAllButtonsInButtonRow() {
      let button_row = document.getElementById("main_button_row");
      for (let i = 0; i < button_row.children.length; i++)
        button_row.children[i].style.display = "none";
      button_row.style.display = "none";
    }

    function addCurves(element) {
      element.style.borderTopLeftRadius = "20px";
      element.style.borderTopRightRadius = "20px";
    }

    function switchToSetMaker(e) {
      switchToTab(
        document.getElementById("set_tab"),
        document.getElementById("set_display")
      );

      document.getElementById("add_set_button").style.display = "";
      document.getElementById("save_set_button").style.display = "";
      document.getElementById("save_to_practice_button").style.display = "";
      document.getElementById("mockup_set_button").style.display = "";
      document.getElementById("test_set_button").style.display = "";

      document.getElementById("main_button_row").style.display = "";
    }

    function switchToVideoSetUp(e) {
      switchToTab(
        document.getElementById("video_tab"),
        document.getElementById("video_display")
      );

      addCurves(document.getElementById("video_display"));
    }

    function switchToSettings(e) {
      switchToTab(
        document.getElementById("settings_tab"),
        document.getElementById("settings_display")
      );
      addCurves(document.getElementById("settings_display"));
    }

    function switchToPracticesTab(e) {
      switchToTab(
        document.getElementById("practices_tab"),
        document.getElementById("practices_display")
      );
      addCurves(document.getElementById("practices_display"));
    }

    function saveIndividualSetClicked(e) {
      const practice_short_description = document.getElementById(
        "practice_short_description"
      );
      practice_short_description.value = " ";
      textAreaAdjust({ target: practice_short_description });
      practice_short_description.addEventListener("input", textAreaAdjust);
      document.getElementById("save_set_modal").style.display = "";
    }

    function saveAsPracticeClicked(e) {
      document.getElementById("save_practice_modal").style.display = "";
    }

    function saveSet(e) {
      document.getElementById("save_practice_modal").style.display = "";
    }

    function closeModal(e) {
      e.parentElement.parentElement.parentElement.style.display = "none";
      e.parentElement.parentElement.children[1].children[0].style.display =
        "none";
    }

    function addSetDescription(e) {
      let sub_display_display = this.parentElement.parentElement;

      if (this.innerText.includes("Add")) {
        const description_container = document.createElement("div");
        description_container.classList.add("description_container");
        if (sub_display_display.children.length > 1)
          sub_display_display.insertBefore(
            description_container,
            sub_display_display.children[1]
          );
        else sub_display_display.appendChild(description_container);

        const set_description_label = document.createElement("div");
        set_description_label.classList.add("set_description_label");
        set_description_label.innerText = "Set Description:";
        description_container.appendChild(set_description_label);

        const set_description_input = document.createElement("textarea");
        set_description_input.addEventListener("keyup", textAreaAdjust);
        set_description_input.classList.add("set_description_input");
        description_container.appendChild(set_description_input);
        textAreaAdjust({ target: set_description_input });
        this.classList.remove("btn-primary");
        this.classList.add("btn-danger");
        this.innerText = "Remove Set Description";
      } else {
        sub_display_display.children[1].remove();
        this.classList.remove("btn-danger");
        this.classList.add("btn-primary");
        this.innerText = "Add Set Description";
      }
    }

    function textAreaAdjust(e) {
      e.target.style.height = "1px";
      e.target.style.height = 14 + e.target.scrollHeight + "px";
    }

    function removeFromList(list, item_to_remove) {
      let new_array = [];
      for (let i = 0; i < list.length; i++) {
        if (list[i] != item_to_remove) {
          new_array.push(list[i]);
        }
      }

      return new_array;
    }

    function saveIndivdualSet(e) {
      let set_display = document.getElementById("set_display");
      let set_repeats = parseInt(
        set_display.children[0].children[0].children[1].children[0].value
      );
      let main_set = set_display.children[0].children[1].children[1].children;

      let start = Date.now();
      let set = _getSetObject(main_set, set_repeats);
      let sendoffs = _getSendoffLists(set);
      let end = Date.now();
      let time = end - start;

      let name =
        e.parentElement.parentElement.children[1].children[0].children[1]
          .children[0].value;
      let date =
        e.parentElement.parentElement.children[1].children[1].children[1]
          .children[0].value;
      let key_words =
        e.parentElement.parentElement.children[1].children[2].children[1]
          .children[0].value;
      let description =
        e.parentElement.parentElement.children[1].children[3].children[1]
          .children[0].value;

      let today = new Date();

      let filename =
        today.getFullYear() +
        "-" +
        today.getMonth() +
        "-" +
        today.getDay() +
        "-SET-" +
        name.replace(/\s/g, "");

      if (name != "") {
        let individual_set = {
          name: name,
          date: date,
          key_words: key_words,
          description: description,
          set: set,
        };

        e.parentElement.parentElement.parentElement.parentElement.style.display =
          "none";
        e.parentElement.parentElement.children[0].style.display = "none";
      } else {
        e.parentElement.parentElement.children[0].style.display = "";
      }
    }

    async function saveAsPractice(e) {
      //document.getElementById("save_practice_modal").remove(); //TODO: get rid of this when finished
      let practice_saving_status = document.getElementById(
        "practice_saving_status"
      );
      practice_saving_status.innerText = "Saving practice...";
      practice_saving_status.style.display = "";
      try {
        let set_display = document.getElementById("set_display");
        let set_displays = set_display.children;

        let practice_object = {};
        practice_object.practice = {};
        let start = performance.now();
        let set, sendoffs;
        for (let i = 0; i < set_displays.length; i++) {
          let set_repeats = parseInt(
            set_displays[i].children[0].children[1].children[0].value
          );
          let main_set = set_displays[i].children[1].children[1].children;

          let set = _getSetObject(main_set, set_repeats);
          let sendoffs = _getSendoffLists(set);
          practice_object.practice[i] = set;
        }

        let practice_number =
          e.parentElement.parentElement.children[1].children[0].children[1]
            .children[0].value;
        let group =
          e.parentElement.parentElement.children[1].children[1].children[1]
            .children[0].value;
        let date =
          e.parentElement.parentElement.children[1].children[2].children[1]
            .children[0].value;
        let key_words =
          e.parentElement.parentElement.children[1].children[3].children[1]
            .children[0].value;
        let description =
          e.parentElement.parentElement.children[1].children[4].children[1]
            .children[0].value;

        practice_object.practice_number = parseInt(practice_number);
        practice_object.group = group;
        practice_object.date = date;
        practice_object.key_words = key_words;
        practice_object.description = description;
        practice_object.coach_id = COACH_ID;

        let today = new Date();

        let filename =
          today.getFullYear() +
          "-" +
          (today.getMonth() + 1) +
          "-" +
          today.getDate() +
          "-PRACTICE-" +
          practice_number +
          "-" +
          group +
          ".json";

        practice_object.filename = filename;

        let end = performance.now();
        let time = end - start;
        console.log("Time to process practice: " + time + "ms");

        let temp = JSON.stringify(practice_object);

        let answer = await fetch(
          "https://wrsmqorkonj3w2fk22ekct2o3m0gngqg.lambda-url.us-east-2.on.aws/",
          {
            method: "POST",
            body: JSON.stringify(practice_object),
          }
        );

        if (!answer.ok || Math.trunc(answer.status / 100) != 2) {
          practice_saving_status.style.color = "red";
          practice_saving_status.innerText = "ERROR SAVING PRACTICE";
        } else {
          e.parentElement.parentElement.parentElement.parentElement.style.display =
            "none";
          e.parentElement.parentElement.children[0].style.display = "none";
          practice_saving_status.style.display = "none";
          practice_saving_status.innerText = "";
        }
      } catch (error) {
        e.parentElement.parentElement.children[0].style.display = "";
        console.log(error);
      }
    }

    function _getSetObject(set_html_collection, repeats) {
      let main_set = set_html_collection;
      let description_visible = false;
      if (main_set[1])
        description_visible =
          main_set[1].classList[0] == "description_container";
      let set = { repeats: repeats };

      let elements = 0;
      let valid = _isSetValid(main_set);

      if (!valid) return null;

      for (let i = 1; i < main_set.length; i++) {
        if (
          main_set[i].classList[0] == "element_row" &&
          main_set[i].children[1].children.length == 0
        ) {
          let element = { type: "standard" };

          let main_set_key = i;
          if (description_visible) {
            main_set_key++;
          }

          let reps = main_set[main_set_key].children[0].children[0].value;
          element.distance =
            main_set[main_set_key].children[0].children[2].value;
          element.description =
            main_set[main_set_key].children[0].children[3].value;
          element.sendoffs = {};
          element.sendoffs.A = {};
          element.sendoffs.A.reps = parseInt(reps);
          element.sendoffs.A.time = getSeconds(
            main_set[main_set_key].children[0].children[4].children[1].value
          );
          for (
            let j = 5;
            j < main_set[main_set_key].children[0].children.length - 4;
            j++
          ) {
            let letter = main_set[main_set_key].children[0].children[
              j
            ].children[0].innerText.replace(":", "");
            let value = getSeconds(
              main_set[main_set_key].children[0].children[j].children[2].value
            );
            let sub_reps =
              main_set[main_set_key].children[0].children[j].children[1]
                .innerText;
            sub_reps = sub_reps.substring(0, sub_reps.indexOf(" "));
            sub_reps = parseInt(sub_reps);
            element.sendoffs[letter] = {};
            element.sendoffs[letter].time = value;
            element.sendoffs[letter].reps = sub_reps;
          }
          set[elements] = element;
          elements++;
        } else if (
          main_set[i].classList[0] == "element_row" &&
          main_set[i].children[1].children.length != 0
        ) {
          let top_part = main_set[i].children[0];
          let description_row = main_set[i].children[1];
          let max_reps = parseInt(top_part.children[0].value);
          let set_reps = -1;
          if (
            top_part.parentElement.multi_description_type ==
            MULTI_DESCRIPTION_TYPE.BY_ROUND
          )
            set_reps = parseInt(
              top_part.parentElement.parentElement.parentElement.parentElement
                .children[0].children[1].children[0].value
            );
          let element = { type: "multi-part", max_reps: max_reps };
          if (set_reps != -1) {
            element.set_reps = set_reps;
          }
          element.multi_description_type = main_set[i].multi_description_type;
          element.distance = top_part.children[2].value;
          element.sendoffs = {};
          let description_number = 0;
          for (let k = 1; k < main_set[i].children.length; k++) {
            let description = main_set[i].children[k];

            let letter = "A";
            let rep = description.children[0].children[0].value;
            let value = description.children[1].children[1].value.trim();
            let description_text = description.children[0].children[1].value;
            if (element.sendoffs.A == undefined) element.sendoffs.A = [];
            let description_object = {};
            description_object.rep = rep;
            description_object.description = description_text;
            description_object.value = getSeconds(value);
            element.sendoffs.A.push(description_object);
            for (let j = 2; j < description.children.length - 3; j++) {
              let letter = description.children[
                j
              ].children[0].innerText.replace(":", "");
              let rep = description.children[
                j
              ].children[1].children[0].value.replace(":", "");
              let loop_value = getSeconds(
                description.children[j].children[2].value
              );
              let description_text = description.children[0].children[1].value;

              if (element.sendoffs[letter] == undefined)
                element.sendoffs[letter] = [];
              let description_object = {};
              description_object.rep = rep;
              description_object.description = description_text;
              description_object.value = loop_value;
              element.sendoffs[letter].push(description_object);
            }

            description_number++;
          }

          set[elements] = element;
          elements++;
        } else if (main_set[i].classList[0] == "sub_container") {
          let subset_repeats = parseInt(
            main_set[i].children[0].children[1].children[0].value
          );
          let subset_elements = main_set[i].children[1].children[1].children;
          let subset_object = _getSetObject(subset_elements, subset_repeats);

          let subset_element = { type: "subset", set: subset_object };

          set[elements] = subset_element;
          elements++;
        }
      }

      return set;
    }

    function _isSetValid(set) {
      //check all the custom description numbers
      for (let i = 0; i < set.length; i++) {
        let row = set[i];
        if (
          row.classList[0] == "element_row" &&
          row.children[1].children.length != 0
        ) {
          let max_reps = parseInt(row.children[0].children[0].value);
          for (let j = 1; j < row.children.length; j++) {
            let description_row = row.children[j];

            //A numbers
            let first_numbers = description_row.children[0].children[0];
            if (
              !_isValidDescriptionNumbers(
                first_numbers.value,
                row.multi_description_type,
                max_reps
              )
            ) {
              return false;
            }
          }
        }
      }

      //check all the sendoffs
      for (let i = 0; i < set.length; i++) {
        if (
          set[i].classList[0] == "element_row" &&
          set[i].children[1].children.length == 0
        ) {
          let element_row = set[i];
          for (let j = 0; j < element_row.sendoffs_list.length; j++) {
            if (element_row.sendoffs_list[j].valid_sendoff != undefined) {
              if (
                !element_row.sendoffs_list[j].valid_sendoff ||
                element_row.sendoffs_list[j].value == ""
              ) {
                return false;
              }
            } else {
              return false;
            }
          }
        } else if (
          set[i].classList[0] == "element_row" &&
          set[i].children[1].children.length != 0
        ) {
          for (let k = 1; k < set[i].children.length; k++) {
            let description_row = set[i].children[k];
            if (
              !description_row.children[1].children[1].valid_sendoff ||
              description_row.children[1].children[1].value == ""
            )
              return false;
            for (let j = 2; j < description_row.children.length - 3; j++) {
              if (
                !description_row.children[j].children[2].valid_sendoff ||
                description_row.children[j].children[2].value == ""
              )
                return false;
            }
          }
        } else if (set[i].classList[0] == "sub_container") {
          return _isSetValid(set[i].children[1].children[1].children);
        }
      }

      return true;
    }

    function _isValidDescriptionNumbers(value, type, max_reps) {
      value = value.replace(/\s/g, "");
      value = value.replace(/:/g, "");
      if (type == MULTI_DESCRIPTION_TYPE.BY_ROUND) {
        value = value.toUpperCase();
        value = value.replace("RD", "");
      }
      if (!containsOnlyAcceptableChars(value)) return false;
      let comma_split = value.split(",");
      let numbers = [];
      for (let i = 0; i < comma_split.length; i++) {
        let split_part = comma_split[i];
        if (split_part.includes("-")) {
          let split_dash = split_part.split("-");
          if (split_dash.length != 2) {
            return false;
          }
          let first_number = parseInt(split_dash[0]);
          let second_number = parseInt(split_dash[1]);
          if (isNaN(first_number) || isNaN(second_number)) {
            return false;
          }
          for (let j = first_number; j <= second_number; j++) {
            numbers.push(j);
          }
        } else {
          let number = parseInt(split_part);
          if (isNaN(number)) {
            return false;
          }

          numbers.push(number);
        }
      }

      if (type != MULTI_DESCRIPTION_TYPE.BY_ROUND) {
        for (let i = 0; i < numbers.length; i++) {
          if (numbers[i] > max_reps) {
            return false;
          }
        }
      }

      return true;
    }

    function mockUpSet(e) {
      document.getElementById("add_set_button").click();
      // let sub_container = document.getElementsByClassName("sub_container")[0];

      // sub_container.children[1].children[1].children[0].children[0].click();
      // setTimeout(() => {}, 10);

      // //temp - only multiline
      // sub_container.children[1].children[1].children[1].children[0].children[7].click();
      // setTimeout(() => {}, 10);
      // sub_container.children[1].children[1].children[1].children[0].children[9].click();
      // setTimeout(() => {}, 10);
      // sub_container.children[1].children[1].children[1].children[0].children[0].value = 5;
      // sub_container.children[1].children[1].children[1].children[1].children[2].click();
      // setTimeout(() => {}, 10);
      // sub_container.children[1].children[1].children[1].children[1].children[3].click();
      // setTimeout(() => {}, 10);
      // sub_container.children[1].children[1].children[1].children[0].children[0].dispatchEvent(
      //   new InputEvent("change")
      // );
      // sub_container.children[1].children[1].children[1].children[0].children[2].value = 50;
      // sub_container.children[1].children[1].children[1].children[1].children[0].children[1].value =
      //   "Back";
      // sub_container.children[1].children[1].children[1].children[1].children[1].children[1].value =
      //   "40";
      // sub_container.children[1].children[1].children[1].children[1].children[1].children[1].dispatchEvent(
      //   new InputEvent("input")
      // );
      // sub_container.children[1].children[1].children[1].children[1].children[2].children[2].value =
      //   "40";
      // sub_container.children[1].children[1].children[1].children[1].children[2].children[2].dispatchEvent(
      //   new InputEvent("input")
      // );
      // sub_container.children[1].children[1].children[1].children[1].children[3].children[2].value =
      //   "45";
      // sub_container.children[1].children[1].children[1].children[1].children[3].children[2].dispatchEvent(
      //   new InputEvent("input")
      // );

      let sub_container = document.getElementsByClassName("sub_container")[0];
      sub_container.children[1].children[1].children[0].children[0].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[0].children[0].click();
      sub_container.children[1].children[1].children[1].children[0].children[0].value = 5;
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[5].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[6].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[0].children[7].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[1].children[2].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[1].children[3].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[0].children[2].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].select();
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].value =
        "100";
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].select();
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].value =
        "110";
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].select();
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].value =
        "120";
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[0].children[0].value = 5;
      sub_container.children[1].children[1].children[2].children[0].children[0].dispatchEvent(
        new InputEvent("change")
      );
      sub_container.children[1].children[1].children[1].children[0].children[3].value =
        "Free";
      sub_container.children[1].children[1].children[2].children[0].children[2].value = 50;
      sub_container.children[1].children[1].children[2].children[1].children[0].children[1].value =
        "Back";
      sub_container.children[1].children[1].children[2].children[1].children[1].children[1].value =
        "40";
      sub_container.children[1].children[1].children[2].children[1].children[1].children[1].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[1].children[2].children[2].value =
        "40";
      sub_container.children[1].children[1].children[2].children[1].children[2].children[2].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[1].children[3].children[2].value =
        "45";
      sub_container.children[1].children[1].children[2].children[1].children[3].children[2].dispatchEvent(
        new InputEvent("input")
      );
      let index =
        sub_container.children[1].children[1].children[2].children[0].children
          .length - 1;
      sub_container.children[1].children[1].children[2].children[0].children[
        index
      ].click();
      sub_container.children[1].children[1].children[2].children[2].children[0].children[1].value =
        "Back kick";
      sub_container.children[1].children[1].children[2].children[2].children[1].children[1].value =
        "40";
      sub_container.children[1].children[1].children[2].children[2].children[1].children[1].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[2].children[2].children[2].value =
        "40";
      sub_container.children[1].children[1].children[2].children[2].children[2].children[2].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[2].children[3].children[2].value =
        "45";
      sub_container.children[1].children[1].children[2].children[2].children[3].children[2].dispatchEvent(
        new InputEvent("input")
      );
      //--------------------------
      sub_container = sub_container.children[1].children[1].children[3];
      //--------------------------
      sub_container.children[1].children[1].children[0].children[0].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[0].children[0].click();
      sub_container.children[1].children[1].children[1].children[0].children[0].value = 5;
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[5].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[6].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[0].children[7].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[1].children[2].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[1].children[3].click();
      setTimeout(() => {}, 10);
      //sub_container.children[1].children[1].children[0].children[2].click();
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].select();
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].value =
        "100";
      sub_container.children[1].children[1].children[1].children[0].children[4].children[1].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].select();
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].value =
        "110";
      sub_container.children[1].children[1].children[1].children[0].children[5].children[2].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].select();
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].value =
        "120";
      sub_container.children[1].children[1].children[1].children[0].children[6].children[2].dispatchEvent(
        new InputEvent("input")
      );
      setTimeout(() => {}, 10);
      sub_container.children[1].children[1].children[2].children[0].children[0].value = 5;
      sub_container.children[1].children[1].children[2].children[0].children[0].dispatchEvent(
        new InputEvent("change")
      );
      sub_container.children[1].children[1].children[1].children[0].children[3].value =
        "Free";
      sub_container.children[1].children[1].children[2].children[0].children[2].value = 50;
      sub_container.children[1].children[1].children[2].children[1].children[0].children[1].value =
        "Back";
      sub_container.children[1].children[1].children[2].children[1].children[1].children[1].value =
        "40";
      sub_container.children[1].children[1].children[2].children[1].children[1].children[1].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[1].children[2].children[2].value =
        "40";
      sub_container.children[1].children[1].children[2].children[1].children[2].children[2].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[1].children[3].children[2].value =
        "45";
      sub_container.children[1].children[1].children[2].children[1].children[3].children[2].dispatchEvent(
        new InputEvent("input")
      );
      index =
        sub_container.children[1].children[1].children[2].children[0].children
          .length - 1;
      sub_container.children[1].children[1].children[2].children[0].children[
        index
      ].click();
      sub_container.children[1].children[1].children[2].children[2].children[0].children[1].value =
        "Back kick";
      sub_container.children[1].children[1].children[2].children[2].children[1].children[1].value =
        "40";
      sub_container.children[1].children[1].children[2].children[2].children[1].children[1].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[2].children[2].children[2].value =
        "40";
      sub_container.children[1].children[1].children[2].children[2].children[2].children[2].dispatchEvent(
        new InputEvent("input")
      );
      sub_container.children[1].children[1].children[2].children[2].children[3].children[2].value =
        "45";
      sub_container.children[1].children[1].children[2].children[2].children[3].children[2].dispatchEvent(
        new InputEvent("input")
      );
    }

    function containsOnlyAcceptableChars(str) {
      return /^[0-9,-]+$/.test(str);
    }

    function getSeconds(regular_time) {
      let split = regular_time.split(":");
      if (split.length == 1) {
        return parseInt(split[0]);
      }
      let min = 0;
      if (split[0] != "") {
        min = parseInt(split[0]);
      }
      let sec = 0;
      if (split[1] != "") {
        sec = parseInt(split[1]);
      }
      return min * 60 + sec;
    }

    function calculateTimes(set_to_calculate_for) {
      set_to_calculate_for = getParentSetIfSubSet(set_to_calculate_for);
      if (set_to_calculate_for.classList[0] != "sub_container") return null;
      let repeat_count = parseInt(
        set_to_calculate_for.children[0].children[1].children[0].value
      );
      let set_display = set_to_calculate_for.children[1].children[1].children;

      let set, sendoff_lists;
      try {
        set = _getSetObject(set_display, repeat_count);
        sendoff_lists = _getSendoffLists(set);
      } catch {
        recolorCalculatedSendoffsToError(set_to_calculate_for);
        return -1;
      }

      let times_row = set_to_calculate_for.children[1].children[0];

      if (set == undefined || set[0] == undefined) {
        recolorCalculatedSendoffsToError(set_display);
      } else {
        let sendoffs = _getSendoffs(set);
        let end_result = {};
        for (let i = 0; i < sendoffs.length; i++) {
          let result = _getTotalSetTime(sendoff_lists[sendoffs[i]]);
          if (result) end_result[sendoffs[i]] = result;
          else if (result == 0) end_result[sendoffs[i]] = result;
        }

        if (Object.keys(end_result).length > 0) {
          while (times_row.children.length > 1)
            times_row.children[times_row.children.length - 1].remove();

          let letters = Object.keys(end_result);

          for (let i = 0; i < letters.length; i++) {
            let letter = letters[i];
            let display_time = end_result[letter];

            let min = Math.trunc(display_time / 60);
            let sec = display_time - 60 * min;
            if (sec < 10) sec = "0" + sec;

            const set_time = document.createElement("div");
            set_time.classList.add("set_time");
            set_time.innerText = letter + ": " + min + ":" + sec;
            times_row.appendChild(set_time);
          }
        } else {
          for (let i = 1; i < times_row.children.length; i++) {
            times_row.children[i].style.backgroundColor =
              ERROR_BACKGROUND_COLOR;
          }
        }
      }
    }

    function getParentSetIfSubSet(set_to_check) {
      let last_that_is_a_set = set_to_check;
      let element_to_check = set_to_check;
      while (element_to_check.parentElement) {
        element_to_check = element_to_check.parentElement;
        if (
          element_to_check.classList.length > 0 &&
          element_to_check.classList[0] == "sub_container"
        ) {
          last_that_is_a_set = element_to_check;
        }
      }

      return last_that_is_a_set;
    }

    function _getTotalSetTime(list_of_sendoffs) {
      return list_of_sendoffs.running_time;
    }

    function _getSendoffs(set) {
      if (set == null) return null;
      let sendoffs = [];

      let numbers = Object.keys(set);
      let temp = [];
      for (let i = 0; i < numbers.length; i++)
        if (numbers[i] != "repeats") temp.push(numbers[i]);
      numbers = temp;
      for (let i = 0; i < numbers.length; i++) {
        let element = set[numbers[i]];
        if (element.type == "standard" || element.type == "multi-part") {
          let letters = Object.keys(element.sendoffs);
          for (let j = 0; j < letters.length; j++) {
            let letter = letters[j];
            if (!sendoffs.includes(letter)) {
              sendoffs.push(letter);
            }
          }
        } else if (element.type == "subset") {
          let sub_set_letters = _getSendoffs(element.set);
          for (let j = 0; j < sub_set_letters.length; j++)
            if (!sendoffs.includes(sub_set_letters[j]))
              sendoffs.push(sub_set_letters[j]);
        }
      }

      return sendoffs;
    }

    function _acceptableSendoffs(set) {
      let element_keys = Object.keys(set);
      let sendoff_counts = [];
      let temp = [];
      for (let i = 0; i < element_keys.length; i++)
        if (element_keys[i] != "repeats") temp.push(element_keys[i]);
      element_keys = temp;

      let number_of_sendoffs = -1;
      for (let i = 0; i < element_keys.length; i++) {
        let element = set[i];
        if (element) {
          if (element.type == "standard" || element.type == "multi-part") {
            let sendoff_keys = Object.keys(element.sendoffs);
            let sendoffs_count_for_element = sendoff_keys.length;
            if (sendoffs_count_for_element > 1 && number_of_sendoffs == -1) {
              number_of_sendoffs = sendoffs_count_for_element;
            } else {
              if (
                sendoffs_count_for_element != number_of_sendoffs &&
                sendoffs_count_for_element != 1
              ) {
                return false;
              }
            }
            sendoff_counts.push(sendoff_keys);
          } else if (element.type == "subset") {
            if (!_acceptableSendoffs(element)) {
              return false;
            }
          }
        }
      }

      temp = [];
      for (let i = 0; i < sendoff_counts; i++)
        if (sendoff_counts[i] > 1) temp.push(sendoff_counts[i]);
      sendoff_counts = temp;

      let first_count = sendoff_counts[0];
      if (first_count) {
        for (let i = 0; i < first_count.length; i++) {
          if (first_count != sendoff_counts[i]) {
            return false;
          }
        }
      }

      return true;
    }

    function _getTimeForSendoff(sendoff_letter, set, first_sendoff_letter) {
      if (!_acceptableSendoffs(set)) return undefined;

      let element_keys = Object.keys(set);
      let temp = [];
      for (let i = 0; i < element_keys.length; i++)
        if (element_keys[i] != "repeats") temp.push(element_keys[i]);
      element_keys = temp;

      let time = 0;
      for (let i = 0; i < element_keys.length; i++) {
        let element = set[i];
        if (element.type == "standard") {
          if (element.sendoffs[sendoff_letter])
            time +=
              60 * parseInt(element.reps) + element.sendoffs[sendoff_letter];
          else time += 60 * parseInt(element.reps);
        } else if (element.type == "multi-part") {
          let multi_element = element.sendoffs[sendoff_letter];
          if (multi_element == undefined)
            multi_element = element.sendoffs[first_sendoff_letter];
          let parts = _splitMultiPartToIndividualParts(multi_element);

          let numbers = Object.keys(parts);
          for (let j = 0; j < numbers.length; j++) {
            time += parseInt(parts[numbers[j]].value);
          }
        } else if ((element.type = "subset")) {
          let set_time = _getTimeForSendoff(sendoff_letter, element.set);
          time += set_time;
        }
      }

      return time;
    }

    function _splitMultiPartToIndividualParts(multi_part_sendoff) {
      let part_keys = Object.keys(multi_part_sendoff);
      let parts = [];
      let numbers = {};
      for (let i = 0; i < part_keys.length; i++) {
        let numbers_list = _splitDescriptionIntoNumbers(
          multi_part_sendoff[part_keys[i]]
        );
        let sub_numbers = Object.keys(numbers_list);
        for (let j = 0; j < sub_numbers.length; j++) {
          let temp = numbers_list[sub_numbers[j]];
          numbers[sub_numbers[j]] = temp;
        }
      }
      return numbers;
    }

    function _splitDescriptionIntoNumbers(description, type) {
      if (!type) type = 2;
      let temp = _isValidDescriptionNumbers(description.rep, type, 1000000);
      if (!temp) return undefined;

      let rep_text = description.rep;
      rep_text = rep_text.replace(/\s/g, "");
      if (rep_text.endsWith(":"))
        rep_text = rep_text.substring(0, rep_text.length - 1);

      let split_by_comma = rep_text.split(",");
      let parts = {};
      for (let i = 0; i < split_by_comma.length; i++) {
        let part = split_by_comma[i];

        if (!part.includes("-")) {
          let sub_description = {};
          sub_description.description = description.description;
          sub_description.value = description.value;

          parts[part] = sub_description;
        } else {
          let split_by_hypen = split_by_comma[i].split("-");
          let min = parseInt(split_by_hypen[0]);
          let max = parseInt(split_by_hypen[1]);
          for (let j = min; j <= max; j++) {
            let sub_description = {};
            sub_description.description = description.description;
            sub_description.value = description.value;

            parts[j] = sub_description;
          }
        }
      }

      return parts;
    }

    function _getSendoffLists(set) {
      let by_round_elements = [];
      if (set == null) return null;
      let all_sendoffs = _getSendoffs(set);
      all_sendoffs.sort((a, b) => parseInt(a) - parseInt(b));
      let more_than_one_sendoff = false;
      if (all_sendoffs.length > 1) more_than_one_sendoff = true;

      if (all_sendoffs.length == 0) return null;

      let element_keys = Object.keys(set);
      let temp = [];
      for (let i = 0; i < element_keys.length; i++)
        if (element_keys[i] != "repeats") temp.push(element_keys[i]);
      element_keys = temp;
      element_keys.sort((a, b) => parseInt(a) - parseInt(b));
      let first_sendoff = all_sendoffs[0];
      let sendoff_lists = {};
      for (let i = 0; i < all_sendoffs.length; i++) {
        sendoff_lists[all_sendoffs[i]] = {};
        sendoff_lists[all_sendoffs[i]].start_time = 0;
        sendoff_lists[all_sendoffs[i]].running_time = 0;
        sendoff_lists[all_sendoffs[i]].list = [];
      }
      for (let i = 0; i < set.repeats; i++) {
        for (let l = 0; l < element_keys.length; l++) {
          let sendoffs_done_list = [];
          let element = set[element_keys[l]];

          //standard element processing
          if (element.type == "standard") {
            let list = [];

            for (let j = 0; j < all_sendoffs.length; j++) {
              let sendoff_this_is = all_sendoffs[j];
              sendoffs_done_list.push(sendoff_this_is);
              let letter_to_get_sendoffs_for = all_sendoffs[j];
              let element_sendoffs = Object.keys(element.sendoffs);
              if (
                element_sendoffs.length != all_sendoffs.length &&
                element_sendoffs.length != 1
              )
                throw new Error("Sendoff Mismatch");
              if (!element_sendoffs.includes(letter_to_get_sendoffs_for))
                letter_to_get_sendoffs_for = all_sendoffs[0];

              for (
                let k = 0;
                k < element.sendoffs[letter_to_get_sendoffs_for].reps;
                k++
              ) {
                let item = {
                  time: sendoff_lists[sendoff_this_is].running_time,
                  rep_time: element.sendoffs[letter_to_get_sendoffs_for].time,
                  distance: element.distance,
                  description: element.description,
                  rep_number: k + 1,
                };
                sendoff_lists[sendoff_this_is].running_time += item.rep_time;
                sendoff_lists[sendoff_this_is].list.push(item);
              }
            }
          }

          //multi-part element processing
          else if (element.type == "multi-part") {
            for (let j = 0; j < all_sendoffs.length; j++) {
              let sendoff_this_is = all_sendoffs[j];
              let letter_to_get_sendoffs_for = all_sendoffs[j];
              let element_sendoffs = Object.keys(element.sendoffs);
              let temp = [];
              for (let t = 0; t < element_sendoffs.length; t++)
                if (/^[a-zA-Z]$/.test(element_sendoffs[t]))
                  temp.push(element_sendoffs[t]);
              element_sendoffs = temp;
              element_sendoffs.sort((a, b) => parseInt(a) - parseInt(b));

              if (
                element_sendoffs.length != all_sendoffs.length &&
                element_sendoffs.length != 1
              )
                throw new Error("Sendoff Mismatch");
              let first_set_description_count =
                element.sendoffs[element_sendoffs[0]].length;
              for (let p = 1; p < element_sendoffs.length; p++) {
                if (
                  first_set_description_count !=
                    element.sendoffs[element_sendoffs[p]].length &&
                  element.sendoffs[element_sendoffs[p]].length != 1
                )
                  throw new Error("Sendoff Mismatch");
              }
              if (!element_sendoffs.includes(letter_to_get_sendoffs_for))
                letter_to_get_sendoffs_for = all_sendoffs[0];

              let parts_key = Object.keys(
                element.sendoffs[letter_to_get_sendoffs_for]
              );
              parts_key.sort((a, b) => parseInt(a) - parseInt(b));
              let temp_list = [];
              let running_time = sendoff_lists[sendoff_this_is].running_time;

              if (
                element.multi_description_type ==
                MULTI_DESCRIPTION_TYPE.SPLIT_EVENLY
              ) {
                for (k = 0; k < parts_key.length; k++) {
                  let part =
                    element.sendoffs[letter_to_get_sendoffs_for][parts_key[k]];
                  let numbers = _splitDescriptionIntoNumbers(part);
                  let ind_numbers = Object.keys(numbers);
                  ind_numbers.sort((a, b) => parseInt(a) - parseInt(b));
                  for (let num = 0; num < ind_numbers.length; num++) {
                    let num_to_get = ind_numbers[num];
                    let item = {
                      time: running_time,
                      rep_time: numbers[num_to_get].value,
                      distance: element.distance,
                      description: numbers[num_to_get].description,
                      rep_number: parseInt(num_to_get),
                    };
                    //sendoff_lists[sendoff_this_is].running_time += item.rep_time;
                    //sendoff_lists[sendoff_this_is].list.push(item);
                    running_time += item.rep_time;
                    temp_list.push(item);
                  }
                  temp_list.sort((item1, item2) => {
                    return item1.rep_number - item2.rep_number;
                  });
                  let last_number = temp_list[0].rep_number;

                  for (let q = 1; q < temp_list.length; q++) {
                    if (last_number >= temp_list[q].rep_number)
                      throw new Error("Sendoff Mismatch");
                    else last_number = temp_list[q].rep_number;
                  }
                }
                sendoff_lists[sendoff_this_is].list.push(...temp_list);
                sendoff_lists[sendoff_this_is].running_time = running_time;
              } else if (
                element.multi_description_type ==
                MULTI_DESCRIPTION_TYPE.REPEAT_ONE_AT_A_TIME
              ) {
                let running_time = sendoff_lists[sendoff_this_is].running_time;
                for (k = 0; k < parts_key.length; k++) {
                  let part =
                    element.sendoffs[letter_to_get_sendoffs_for][parts_key[k]];
                  let numbers = _splitDescriptionIntoNumbers(part);
                  let ind_numbers = Object.keys(numbers);
                  ind_numbers.sort((a, b) => parseInt(a) - parseInt(b));
                  for (let num = 0; num < ind_numbers.length; num++) {
                    let num_to_get = ind_numbers[num];
                    let item = {
                      time: sendoff_lists[sendoff_this_is].running_time,
                      rep_time: numbers[num_to_get].value,
                      distance: element.distance,
                      description: numbers[num_to_get].description,
                      rep_number: parseInt(num_to_get),
                    };
                    running_time += item.rep_time;
                    temp_list.push(item);
                  }
                }
                temp_list.sort((item1, item2) => {
                  return item1.rep_number - item2.rep_number;
                });

                let last_number = temp_list[0].rep_number;
                for (let q = 1; q < temp_list.length; q++) {
                  if (last_number >= temp_list[q].rep_number)
                    throw new Error("Sendoff Mismatch");
                  else last_number = temp_list[q].rep_number;
                }

                let rep = temp_list[0].rep_number;
                if (sendoff_lists[sendoff_this_is].list.length != 0) {
                  running_time =
                    sendoff_lists[sendoff_this_is].list[
                      sendoff_lists[sendoff_this_is].list.length - 1
                    ].time +
                    sendoff_lists[sendoff_this_is].list[
                      sendoff_lists[sendoff_this_is].list.length - 1
                    ].rep_time;
                }
                running_time = sendoff_lists[sendoff_this_is].running_time;
                while (rep <= element.max_reps) {
                  for (
                    let w = 0;
                    w < temp_list.length && rep <= element.max_reps;
                    w++
                  ) {
                    let copy = {
                      time: running_time,
                      rep_time: temp_list[w].rep_time,
                      distance: temp_list[w].distance,
                      description: temp_list[w].description,
                      rep_number: rep,
                    };
                    running_time += copy.rep_time;
                    sendoff_lists[sendoff_this_is].list.push(copy);

                    rep++;
                  }
                }

                sendoff_lists[sendoff_this_is].running_time =
                  sendoff_lists[sendoff_this_is].list[
                    sendoff_lists[sendoff_this_is].list.length - 1
                  ].time +
                  sendoff_lists[sendoff_this_is].list[
                    sendoff_lists[sendoff_this_is].list.length - 1
                  ].rep_time;
              } else if (
                element.multi_description_type ==
                MULTI_DESCRIPTION_TYPE.BY_ROUND
              ) {
                element.id = createElelementID();
                by_round_elements.push(element);

                sendoff_lists[sendoff_this_is].list.push(element);
              }
            }
          } else if (element.type == "subset") {
            let subsendoffs = _getSendoffLists(element.set);
            //have the subsendoffs, copy them to the main sendoff list

            if (all_sendoffs.length != Object.keys(subsendoffs).length)
              return null;

            for (
              let sendoff_index = 0;
              sendoff_index < all_sendoffs.length;
              sendoff_index++
            ) {
              let copying_letter = all_sendoffs[sendoff_index];
              let temp_list = [];
              let running_time = -1;
              if (sendoff_lists[copying_letter].running_time)
                running_time = sendoff_lists[copying_letter].running_time;
              else running_time = 0;
              for (
                let index = 0;
                index < subsendoffs[copying_letter].list.length;
                index++
              ) {
                subsendoffs[copying_letter].list[index].time = running_time;
                sendoff_lists[copying_letter].list.push(
                  subsendoffs[copying_letter].list[index]
                );
                running_time +=
                  subsendoffs[copying_letter].list[index].rep_time;
                sendoff_lists[copying_letter].running_time = running_time;
              }
            }
          }
        }
      }

      //replace by round elemeents
      let need_to_redo_final_sendoff = false;

      //go through each letter that we have sendoffs for
      for (
        let sendoff_index = 0;
        sendoff_index < all_sendoffs.length;
        sendoff_index++
      ) {
        let letter_working_on = all_sendoffs[sendoff_index];

        let element_ids = [];
        //get id's for each by round element
        for (let i = 0; i < sendoff_lists[letter_working_on].list.length; i++) {
          if (
            sendoff_lists[letter_working_on].list[i].multi_description_type ==
            MULTI_DESCRIPTION_TYPE.BY_ROUND
          ) {
            if (
              !element_ids.includes(sendoff_lists[letter_working_on].list[i].id)
            ) {
              element_ids.push(sendoff_lists[letter_working_on].list[i].id);
            }
          }
        }

        //now we have by round elements, go through by each element id and replace the element with lists
        for (
          let element_index = 0;
          element_index < element_ids.length;
          element_index++
        ) {
          need_to_redo_final_sendoff = true;
          let round_working_on = 1;
          let element_id = element_ids[element_index];

          //start copying each sendoff to a temp list until we get to an id that matches

          let final_list_for_letter = [];
          let temp_list = [];
          let running_time = 0;
          for (
            let i = 0;
            i < sendoff_lists[letter_working_on].list.length;
            i++
          ) {
            if (sendoff_lists[letter_working_on].list[i].id != element_id) {
              temp_list.push(sendoff_lists[letter_working_on].list[i]);
            } else {
              //we have found an element that we are replacing sendoffs for
              if (i > 0) {
                running_time =
                  sendoff_lists[letter_working_on].list[i - 1].time +
                  sendoff_lists[letter_working_on].list[i - 1].rep_time;
              }

              let letter_to_get_sendoffs_from = letter_working_on;
              if (
                !sendoff_lists[letter_working_on].list[i].sendoffs[
                  letter_working_on
                ]
              )
                letter_to_get_sendoffs_from = "A";

              let part = sendoff_lists[letter_working_on].list[i];
              let index_of_rep = -1;

              for (
                let k = 0;
                k < part.sendoffs[letter_to_get_sendoffs_from].length;
                k++
              ) {
                let checking = part.sendoffs[letter_to_get_sendoffs_from][k].rep
                  .toUpperCase()
                  .replace("RD", "");
                checking = checking.replace(":", "").trim();
                checking = parseInt(checking);
                if (round_working_on == checking) {
                  index_of_rep = k;
                  break;
                }
              }

              if (index_of_rep != -1) {
                let added_to_temp = false;
                //we now have the index of the rep we are doing, copy it to the temp list
                for (let k = 0; k < part.max_reps; k++) {
                  let item = {
                    time: running_time,
                    rep_time:
                      part.sendoffs[letter_to_get_sendoffs_from][index_of_rep]
                        .value,
                    distance: part.distance,
                    description:
                      part.sendoffs[letter_to_get_sendoffs_from][index_of_rep]
                        .description,
                    rep_number: k + 1,
                  };

                  running_time = running_time + item.rep_time;

                  temp_list.push(item);
                  added_to_temp = true;
                }

                //we changed a round one to a sendoff list, copy the remaining and start over at the top
                if (added_to_temp) {
                  for (
                    j = i + 1;
                    j < sendoff_lists[letter_working_on].list.length;
                    j++
                  ) {
                    let old_item = sendoff_lists[letter_working_on].list[j];
                    if (old_item.type != "multi-part") {
                      let new_item = {
                        time: running_time,
                        rep_time: old_item.rep_time,
                        distance: old_item.distance,
                        description: old_item.description,
                        rep_number: old_item.rep_number,
                      };
                      running_time = running_time + old_item.rep_time;
                      temp_list.push(new_item);
                    } else {
                      temp_list.push(old_item);
                    }
                  }
                  sendoff_lists[letter_working_on].list = temp_list;
                  temp_list = [];
                  i = -1;
                  round_working_on++;
                }
              }
            }
          }
        }
      }

      //remove any unassigned by round parts
      for (let i = 0; i < all_sendoffs.length; i++) {
        let temp_list = [];
        for (let k = 0; k < sendoff_lists[all_sendoffs[i]].list.length; k++) {
          if (!sendoff_lists[all_sendoffs[i]].list[k].type) {
            temp_list.push(sendoff_lists[all_sendoffs[i]].list[k]);
          }
        }
        sendoff_lists[all_sendoffs[i]].list = temp_list;
      }

      if (need_to_redo_final_sendoff) {
        for (let i = 0; i < all_sendoffs.length; i++) {
          sendoff_lists[all_sendoffs[i]].running_time =
            sendoff_lists[all_sendoffs[i]].list[
              sendoff_lists[all_sendoffs[i]].list.length - 1
            ].time +
            sendoff_lists[all_sendoffs[i]].list[
              sendoff_lists[all_sendoffs[i]].list.length - 1
            ].rep_time;
        }
      }

      return sendoff_lists;
    }

    function createElelementID() {
      let letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      letters += letters.toLowerCase();
      letters += "1234567890";
      letters += "-_";

      let id = "";

      while (id.length < 80) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }

      return id;
    }

    function testSetClicked(e) {
      let set_display = document.getElementById("set_display");
      let set_repeats = parseInt(
        set_display.children[0].children[0].children[1].children[0].value
      );
      let main_set = set_display.children[0].children[1].children[1].children;
      let reps = parseInt(
        set_display.children[0].children[0].children[1].children[0].value
      );

      try {
        let set = _getSetObject(main_set, reps);
        let sendoff_lists = _getSendoffLists(set);
        debugger;
      } catch {
        recolorCalculatedSendoffsToError(main_set);
      }
    }

    function recolorCalculatedSendoffsToError(main_set) {
      try {
        let calculated_times_row = main_set.children[1].children[0];
        for (let i = 1; i < calculated_times_row.children.length; i++) {
          calculated_times_row.children[i].style.backgroundColor =
            ERROR_BACKGROUND_COLOR;
        }
      } catch {
        recolorCalculatedSendoffsToError(
          main_set[0].parentElement.parentElement.parentElement
        );
      }
    }

    async function loadPractices() {
      let practices_div = document.getElementById("practices_div");
      const headers = {
        coach_id: "Cpierswim",
        "Content-Type": "application/json",
      };

      const requestOptions = {
        method: "GET",
        headers: headers,
      };

      let result = await fetch(
        "https://c6a7fgweplcxu3yjgx5gkklxce0nopqg.lambda-url.us-east-2.on.aws/?coach_id=" +
          COACH_ID,
        requestOptions
      );

      let practice_info = await result.json();

      let practices = practice_info.practices;
      let metadata = practice_info.metadata;

      practices.sort((a, b) => {
        let a_date = new Date(a.year, a.month - 1, a.day).getTime();
        let b_date = new Date(b.year, b.month - 1, b.day).getTime();
        if (b_date - a_date == 0)
          return b.practice_of_the_day - a.practice_of_the_day;
        return b_date - a_date;
      });

      practices.forEach((practice) => {
        if (practice.group == "") practice.group = "-undefined-";
        const practice_div = document.createElement("div");
        practice_div.classList.add("practice_small_display");
        practice_div.innerText = `${practice.month}/${practice.day}/${practice.year} - Group: ${practice.group}  - #${practice.practice_of_the_day}`;
        practice_div.filename = practice.filename;
        practice_div.addEventListener("click", practiceClicked);
        practices_div.appendChild(practice_div);
      });
    }

    async function practiceClicked(e) {
      debugger;
      let filename = this.filename;
      filename = encodeURIComponent(filename);

      const headers = {
        coach_id: "Cpierswim",
        "Content-Type": "application/json",
      };

      // const requestOptions = {
      //   method: "GET",
      //   headers: headers,
      //   mode: "no-cors",
      // };

      let url =
        "https://lufypj7qre3hbvkvasijiv7rhy0tvrtr.lambda-url.us-east-2.on.aws/?filename=" +
        filename;

      //let result = await fetch(url, requestOptions);
      //let practice_info = await result.json();

      const requestOptions = {
        method: "GET",
        redirect: "follow",
      };

      fetch(url, requestOptions)
        .then((response) => response.text())
        .then((practice) => {
          practice = JSON.parse(practice);
          debugger;
        })
        .catch((error) => console.error(error));
    }
  </script>
</html>
